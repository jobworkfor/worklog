

<pre>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1130px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36&quot; version=&quot;8.5.12&quot; editor=&quot;www.draw.io&quot; type=&quot;browser&quot;&gt;&lt;diagram id=&quot;38554cd8-4f03-e3c3-c4f6-b938e9fb6893&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 1130 1665" style="cursor:pointer;max-width:100%;max-height:1665px;"><defs/><g transform="translate(0.5,0.5)"><g transform="translate(368.5,5.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="73" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">init workflow</div></div></foreignObject><text x="37" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">init workflow</text></switch></g><path d="M 10 56 L 10 33 L 800 33 L 800 56 Z" fill="#fff2cc" stroke="#d6b656" stroke-miterlimit="10" pointer-events="none"/><path d="M 10 56 L 10 1654 L 800 1654 L 800 56" fill="none" stroke="#d6b656" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(375.5,39.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="58" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">init(pid=1)</div></div></foreignObject><text x="29" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica" font-weight="bold">init(pid=1)</text></switch></g><rect x="20" y="66" width="100" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 70 110 L 70 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(50.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="38" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 40px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">init.cpp</div></div></foreignObject><text x="19" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">init.cpp</text></switch></g><rect x="130" y="66" width="110" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 185 110 L 185 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(166.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="36" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 36px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Parser</div></div></foreignObject><text x="18" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Parser</text></switch></g><g transform="translate(202.5,116.5)rotate(90,0,0)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="168" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(204, 204, 204); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">/system/core/init/init_parser.cpp</div></div></foreignObject><text x="84" y="12" fill="#CCCCCC" text-anchor="middle" font-size="12px" font-family="Helvetica">/system/core/init/init_parser.cpp</text></switch></g><rect x="180" y="270" width="10" height="386" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(202.5,277.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="287" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">bool Parser::ParseConfigFile(const std::string&amp; path) {<br /><div>    ParseData(path, data);</div><div><br /></div></div></div></foreignObject><text x="144" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="185" y="310" width="10" height="1056" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(207.5,317.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="694" height="1006" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><span style="background-color: rgb(255 , 242 , 204)">void Parser::ParseData(const std::string&amp; filename, const std::string&amp; data) {</span></div><div><div><font color="#cccccc" style="background-color: rgb(255 , 242 , 204)">    for (;;) {</font></div><div><font color="#cccccc" style="background-color: rgb(255 , 242 , 204)">        switch (next_token(&amp;state)) {</font></div><div><font color="#cccccc" style="background-color: rgb(255 , 242 , 204)"><span>        case T_NEWLINE:</span><br /></font></div><div><font color="#cccccc" style="background-color: rgb(255 , 242 , 204)"><span>            if (section_parsers_.count(args[0])) {</span><br /></font></div></div><div><div><font color="#009900" style="background-color: rgb(255 , 242 , 204)">                // <span>section_parsers_时一个map容器，其中存放了“service”，“action”等section的解析器，具体的解析器通过key值获取</span></font></div><div><span style="background-color: rgb(255 , 242 , 204)">                section_parser = section_parsers_[args[0]].get();</span></div><div><font color="#009900" style="background-color: rgb(255 , 242 , 204)">                // 当前解析的是“<span>service exlight-hal-1-0 /vendor/bin/hw/android.hardware.exlight@1.0-service</span><span>”，所以时用service的解析器</span></font></div><div><span style="background-color: rgb(255 , 242 , 204)"><span>                if (!section_parser-&gt;ParseSection(args, &amp;ret_err)) {</span><br /></span></div></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><div><span style="background-color: rgb(255 , 242 , 204)">                if (!section_parser-&gt;ParseLineSection(args, state.filename,</span></div><div><span style="background-color: rgb(255 , 242 , 204)">                                                      state.line, &amp;ret_err)) {</span></div></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><div><span style="background-color: rgb(255 , 242 , 204)">                if (section_parser) {</span></div><div><span style="background-color: rgb(255 , 242 , 204)">                    section_parser-&gt;EndSection();</span></div><div><br /></div></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><span style="background-color: rgb(255 , 242 , 204)"><br /></span></div><div><br /></div></div></div></foreignObject><text x="347" y="509" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="250" y="66" width="120" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 310 110 L 310 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(271.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="76" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 76px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ServiceParser</div></div></foreignObject><text x="38" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">ServiceParser</text></switch></g><rect x="305" y="468" width="10" height="58" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(327.5,475.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="375" height="68" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><div>bool ServiceParser::ParseSection(const std::vector&lt;std::string&gt;&amp; args,</div><div>                                 std::string* err) {</div></div><div><font color="#009900">    // 将解析出来的exlight-hal-1-0服务保存到section_parser中</font></div><div><div>    service_ = std::make_unique&lt;Service&gt;(name, str_args);</div></div><div><br /></div></div></div></foreignObject><text x="188" y="40" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(322.5,116.5)rotate(90,0,0)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="147" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(204, 204, 204); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">system/core/init/service.cpp</div></div></foreignObject><text x="74" y="12" fill="#CCCCCC" text-anchor="middle" font-size="12px" font-family="Helvetica">system/core/init/service.cpp</text></switch></g><rect x="305" y="580" width="10" height="616" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(327.5,587.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="398" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">bool ServiceParser::ParseLineSection(const std::vector&lt;std::string&gt;&amp; args,</font></div><div><font color="#cccccc">                                     const std::string&amp; filename, int line,</font></div><div><font color="#cccccc">                                     std::string* err) const {</font></div><div>    return service_ ? service_-&gt;ParseLine(args, err) : false;</div></div></div></foreignObject><text x="199" y="33" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="305" y="1260" width="10" height="76" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(327.5,1267.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="374" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><div><font color="#cccccc">void ServiceParser::EndSection() {</font></div><div><font color="#cccccc">    if (service_) {</font></div><div>        ServiceManager::GetInstance().AddService(std::move(service_));</div></div></div></div></foreignObject><text x="187" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 198 468 L 299.63 468" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="195" cy="468" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 304.88 468 L 297.88 471.5 L 299.63 468 L 297.88 464.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 302 526 L 201.37 526" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="305" cy="526" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 196.12 526 L 203.12 522.5 L 201.37 526 L 203.12 529.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 198 580 L 298.63 580" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="195" cy="580" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 303.88 580 L 296.88 583.5 L 298.63 580 L 296.88 576.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 302 1196 L 201.37 1196" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="305" cy="1196" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 196.12 1196 L 203.12 1192.5 L 201.37 1196 L 203.12 1199.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="380" y="66" width="100" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 430 110 L 430 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(409.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="40" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 42px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Service</div></div></foreignObject><text x="20" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Service</text></switch></g><g transform="translate(447.5,119.5)rotate(90,0,0)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="147" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(204, 204, 204); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">system/core/init/service.cpp</div></div></foreignObject><text x="74" y="12" fill="#CCCCCC" text-anchor="middle" font-size="12px" font-family="Helvetica">system/core/init/service.cpp</text></switch></g><rect x="425" y="663" width="10" height="513" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(447.5,670.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="412" height="502" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">bool Service::ParseLine(const std::vector&lt;std::string&gt;&amp; args, std::string* err) {</font></div><div><div><font color="#cccccc">    static const OptionParserMap parser_map;</font></div><div>    auto parser = parser_map.FindFunction(args[0], args.size() - 1, err);</div></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><br /></div><div><div>    return (this-&gt;*parser)(args, err);</div></div><div><br /></div></div></div></foreignObject><text x="206" y="257" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 318 660 L 420.63 660" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="315" cy="660" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 425.88 660 L 418.88 663.5 L 420.63 660 L 418.88 656.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="490" y="66" width="190" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 585 110 L 585 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(499.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="170" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 172px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Service::OptionParserMap::Map</div></div></foreignObject><text x="85" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Service::OptionParserMap::Map</text></switch></g><rect x="580" y="724" width="10" height="412" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(602.5,731.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="409" height="390" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#009900">// 参数解析器对应map</font></div><div>Service::OptionParserMap::Map&amp; Service::OptionParserMap::map() const {</div><div><span>    static const Map option_parsers = {</span><br /></div><div>        {"capabilities",</div><div>                        {1,     kMax, &amp;Service::ParseCapabilities}},</div><div>        {"class",       {1,     kMax, &amp;Service::ParseClass}},</div><div>        {"console",     {0,     1,    &amp;Service::ParseConsole}},</div><div>        {"critical",    {0,     0,    &amp;Service::ParseCritical}},</div><div>        {"disabled",    {0,     0,    &amp;Service::ParseDisabled}},</div><div>        {"group",       {1,     NR_SVC_SUPP_GIDS + 1, &amp;Service::ParseGroup}},</div><div>        {"ioprio",      {2,     2,    &amp;Service::ParseIoprio}},</div><div>        {"priority",    {1,     1,    &amp;Service::ParsePriority}},</div><div>        {"keycodes",    {1,     kMax, &amp;Service::ParseKeycodes}},</div><div>        {"oneshot",     {0,     0,    &amp;Service::ParseOneshot}},</div><div>        {"onrestart",   {1,     kMax, &amp;Service::ParseOnrestart}},</div><div>        {"oom_score_adjust",</div><div>                        {1,     1,    &amp;Service::ParseOomScoreAdjust}},</div><div>        {"namespace",   {1,     2,    &amp;Service::ParseNamespace}},</div><div>        {"seclabel",    {1,     1,    &amp;Service::ParseSeclabel}},</div><div>        {"setenv",      {2,     2,    &amp;Service::ParseSetenv}},</div><div>        {"shutdown",    {1,     1,    &amp;Service::ParseShutdown}},</div><div>        {"socket",      {3,     6,    &amp;Service::ParseSocket}},</div><div>        {"file",        {2,     2,    &amp;Service::ParseFile}},</div><div>        {"user",        {1,     1,    &amp;Service::ParseUser}},</div><div>        {"writepid",    {1,     kMax, &amp;Service::ParseWritepid}},</div><div>    };</div><div><span>    return option_parsers;</span><br /></div><div>}<br /></div></div></div></foreignObject><text x="205" y="201" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 422 1176 L 321.37 1176" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="425" cy="1176" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 316.12 1176 L 323.12 1172.5 L 321.37 1176 L 323.12 1179.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 438 724 L 572.63 724" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="435" cy="724" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 577.88 724 L 570.88 727.5 L 572.63 724 L 570.88 720.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 577 1136 L 441.37 1136" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="580" cy="1136" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 436.12 1136 L 443.12 1132.5 L 441.37 1136 L 443.12 1139.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="690" y="66" width="100" height="44" fill="#ffffff" stroke="#000000" pointer-events="none"/><path d="M 740 110 L 740 1644" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(695.5,82.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="88" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 88px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ServiceManager</div></div></foreignObject><text x="44" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">ServiceManager</text></switch></g><rect x="735" y="1330" width="10" height="66" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(757.5,1337.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="371" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#009900">// 将解析出来的service保存到init的<span>ServiceManager中</span></font></div><div><font color="#cccccc">void ServiceManager::AddService(std::unique_ptr&lt;Service&gt; service) {</font></div><div><span>    services_.emplace_back(std::move(service));</span><br /></div></div></div></foreignObject><text x="186" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 198 1259 L 298.63 1259" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="195" cy="1259" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 303.88 1259 L 296.88 1262.5 L 298.63 1259 L 296.88 1255.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 318 1330 L 729.63 1330" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="315" cy="1330" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 734.88 1330 L 727.88 1333.5 L 729.63 1330 L 727.88 1326.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 78 265 L 175.63 265" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="75" cy="265" rx="3" ry="3" fill="#000000" stroke="#000000" pointer-events="none"/><path d="M 180.88 265 L 173.88 268.5 L 175.63 265 L 173.88 261.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="65" y="165" width="10" height="115" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(87.5,172.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="258" height="40" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div>int main(int argc, char** argv) {<br /></div><div>        parser.set_is_vendor_etc_init_loaded(</div><div>                parser.ParseConfig("/vendor/etc/init"));</div></div></div></foreignObject><text x="129" y="26" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</pre>


添加开机自动执行shell脚本
----------------------------------------------------------------------------------------------------

在应用程序启动之前，往往需要在Android启动过程中去对系统做一些设置，如修改某些文件夹的属主和文件的权限，本文实现在`init.rc`中调用`shell`脚本，而所有对系统资源的修改和配置都在此shell脚本中实现。

1\. 在`system/core/rootdir/etc/init.djstava.sh`脚本文件，以开机获取IP地址为例，脚本内容可如下

```
#! /system/bin/sh

ifconfig eth0 192.168.18.200 netmask 255.255.255.0 up
route add default gw 192.168.18.1 dev eth0
```

2\. 修改`system/core/rootdir/Android.mk`文件,增加语句

```
copy_from += etc/init.djstava.sh
```

3\. 修改`device/$(硬件平台)/init.rc`文件增加语句，将`mount yaffs2 mtd@system /system ro remount`改为`mount yassf2 mtd@system /system rw remount`

```
chmod 755 /system/etc/init.djstava.sh
chown root shell /system/etc/init.djstava.sh

service eth0_set /system/etc/init.djstava.sh
oneshot
```

4\. 设置dns，修改`system/core/rootdir/init.rc`，在`setprop net.tcp.buffersize.gprs`命令后增加如下语句
```
setprop net.dns1 211.167.97.67
setprop net.dns2 202.96.209.133
```
