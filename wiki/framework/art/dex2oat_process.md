TODO
====
<pre>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="484px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36&quot; version=&quot;8.4.8&quot; editor=&quot;www.draw.io&quot;&gt;&lt;diagram id=&quot;5c68d241-c665-670d-1458-295031814a76&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" viewBox="0 0 484 1200" style="cursor:pointer;max-width:100%;max-height:1200px;"><defs/><g transform="translate(0.5,0.5)"><g transform="translate(1.5,6.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="481" height="110" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">/art/runtime/type_lookup_table.cc<br /></font></div><div><font color="#cccccc">TypeLookupTable::TypeLookupTable(const DexFile&amp; dex_file, uint8_t* storage)</font></div><div><font color="#cccccc">    : dex_file_begin_(dex_file.Begin()),</font></div><div><font color="#cccccc">      raw_data_length_(RawDataLength(dex_file.NumClassDefs())),</font></div><div>      mask_(CalculateMask(dex_file.NumClassDefs())),</div><div>      entries_(storage != nullptr ? reinterpret_cast&lt;Entry*&gt;(storage) : new Entry[mask_ + 1]),</div><div><font color="#cccccc">      owns_entries_(storage == nullptr) {</font></div><div><span><font color="#cccccc">  static_assert(alignof(Entry) == 4u, "Expecting Entry to be 4-byte aligned.");</font></span><span>  }</span><br /></div></div></div></foreignObject><text x="241" y="61" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 147.5 Q 210 147.5 210 125.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="150" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 121.12 L 213 127.12 L 210 125.62 L 207 127.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,156.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="460" height="110" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">/art/runtime/type_lookup_table.cc<br /></font></div><div><div><font color="#cccccc">std::unique_ptr&lt;TypeLookupTable&gt; TypeLookupTable::Create(const DexFile&amp; dex_file,</font></div><div><font color="#cccccc">                                                         uint8_t* storage) {</font></div><div><font color="#cccccc">  const uint32_t num_class_defs = dex_file.NumClassDefs();</font></div><div><font color="#cccccc">  return std::unique_ptr&lt;TypeLookupTable&gt;(SupportedSize(num_class_defs)</font></div><div>      ? new TypeLookupTable(dex_file, storage)</div><div><font color="#cccccc">      : nullptr);</font></div><div><font color="#cccccc">}</font></div></div></div></div></foreignObject><text x="230" y="61" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="21" y="75" width="43" height="18" rx="2.7" ry="2.7" fill-opacity="0.75" fill="#dae8fc" stroke="#6c8ebf" stroke-opacity="0.75" pointer-events="none"/><g transform="translate(21.5,77.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="42" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 44px; white-space: nowrap; word-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><span>entries_</span></div></div></foreignObject><text x="21" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 297.5 Q 210 297.5 210 275.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="300" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 271.12 L 213 277.12 L 210 275.62 L 207 277.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,306.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="398" height="124" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">/art/compiler/oat_writer.cc<br /></font></div><div><div><font color="#cccccc">bool OatWriter::WriteTypeLookupTables(</font></div><div><font color="#cccccc">    OutputStream* oat_rodata,</font></div><div><font color="#cccccc">    const std::vector&lt;std::unique_ptr&lt;const DexFile&gt;&gt;&amp; opened_dex_files) {</font></div></div><div><div style="color: rgb(204 , 204 , 204)">  for (size_t i = 0, size = opened_dex_files.size(); i != size; ++i) {</div><div><div style="color: rgb(204 , 204 , 204)">    const DexFile&amp; dex_file = *opened_dex_files[i];</div><div style="color: rgb(204 , 204 , 204)">    {</div><div style="color: rgb(204 , 204 , 204)">      std::unique_ptr&lt;TypeLookupTable&gt; type_lookup_table =</div><div>          TypeLookupTable::Create(dex_file, /* storage */ nullptr);</div></div></div></div></div></foreignObject><text x="199" y="68" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 467.5 Q 210 467.5 210 445.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="470" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 441.12 L 213 447.12 L 210 445.62 L 207 447.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,476.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="398" height="208" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><font color="#cccccc">/art/compiler/oat_writer.cc<br /></font></div><div><div><font color="#cccccc">bool OatWriter::WriteAndOpenDexFiles(</font></div><div><font color="#cccccc">    File* vdex_file,</font></div><div><font color="#cccccc">    OutputStream* oat_rodata,</font></div><div><font color="#cccccc">    InstructionSet instruction_set,</font></div><div><font color="#cccccc">    const InstructionSetFeatures* instruction_set_features,</font></div><div><font color="#cccccc">    SafeMap&lt;std::string, std::string&gt;* key_value_store,</font></div><div><font color="#cccccc">    bool verify,</font></div><div><font color="#cccccc">    bool update_input_vdex,</font></div><div><font color="#cccccc">    /*out*/ std::unique_ptr&lt;MemMap&gt;* opened_dex_files_map,</font></div><div><font color="#cccccc">    /*out*/ std::vector&lt;std::unique_ptr&lt;const DexFile&gt;&gt;* opened_dex_files) {</font><br /><div><font color="#cccccc"><div>  // Write TypeLookupTables into OAT.</div></font></div><div><font color="#cccccc">  if (!</font>WriteTypeLookupTables(&amp;checksum_updating_rodata, dex_files)<font color="#cccccc">) {</font></div><div style="color: rgb(204 , 204 , 204)">    return false;</div><div style="color: rgb(204 , 204 , 204)">  }</div></div></div></div></div></foreignObject><text x="199" y="110" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 707.5 Q 210 707.5 210 675.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="710" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 671.12 L 213 677.12 L 210 675.62 L 207 677.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,716.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="458" height="264" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div style="color: rgb(204 , 204 , 204)"><div>xref: /art/dex2oat/dex2oat.cc</div></div><div style="color: rgb(204 , 204 , 204)">  dex2oat::ReturnCode Setup() {</div><div><div style="color: rgb(204 , 204 , 204)">{</div><div style="color: rgb(204 , 204 , 204)"><span>      for (size_t i = 0, size = oat_writers_.size(); i != size; ++i) {</span><br /></div><div style="color: rgb(204 , 204 , 204)">        rodata_.push_back(elf_writers_[i]-&gt;StartRoData());</div><div style="color: rgb(204 , 204 , 204)"><span>        std::unique_ptr&lt;MemMap&gt; opened_dex_files_map;</span><br /></div><div style="color: rgb(204 , 204 , 204)">        std::vector&lt;std::unique_ptr&lt;const DexFile&gt;&gt; opened_dex_files;</div><div style="color: rgb(204 , 204 , 204)"><span>        const bool verify = !DoDexLayoutOptimizations() &amp;&amp; (input_vdex_file_ == nullptr);</span><br /></div><div><font color="#cccccc">        if (</font>!oat_writers_[i]-&gt;WriteAndOpenDexFiles(</div><div>            kIsVdexEnabled ? vdex_files_[i].get() : oat_files_[i].get(),</div><div>            rodata_.back(),</div><div>            instruction_set_,</div><div>            instruction_set_features_.get(),</div><div>            key_value_store_.get(),</div><div>            verify,</div><div>            update_input_vdex_,</div><div>            &amp;opened_dex_files_map,</div><div>            &amp;opened_dex_files))<font color="#cccccc"> {</font></div><div style="color: rgb(204 , 204 , 204)">          return dex2oat::ReturnCode::kOther;<br /></div></div></div></div></foreignObject><text x="229" y="138" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 1017.5 Q 210 1017.5 210 985.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="1020" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 981.12 L 213 987.12 L 210 985.62 L 207 987.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,1026.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="314" height="110" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><div style="color: rgb(204 , 204 , 204)">/art/dex2oat/dex2oat.cc</div><div><div><font color="#cccccc">static dex2oat::ReturnCode Dex2oat(int argc, char** argv) {</font></div></div><div><div>  dex2oat::ReturnCode setup_code = dex2oat-&gt;Setup();</div></div><div><br /></div><div><br /></div></div><div><br /></div><div><br /></div><div><br /></div></div></div></foreignObject><text x="157" y="61" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 210 1107.5 Q 210 1107.5 210 1075.62" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="210" cy="1110" rx="2.5" ry="2.5" fill="#9673a6" stroke="#9673a6" pointer-events="none"/><path d="M 210 1071.12 L 213 1077.12 L 210 1075.62 L 207 1077.12 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1.5,1116.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="287" height="82" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div><div style="color: rgb(204 , 204 , 204)">/art/dex2oat/dex2oat.cc</div><div><div><font color="#cccccc">int main(int argc, char** argv) {</font></div><div>  int result = static_cast&lt;int&gt;(art::Dex2oat(argc, argv));</div></div></div><div><br /></div><div><br /></div><div><br /></div></div></div></foreignObject><text x="144" y="47" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</pre>

* [Android系统ODEX文件格式解析](http://blog.csdn.net/Roland_Sun/article/details/47183119)
* [Android运行时ART加载类和方法的过程分析](http://blog.csdn.net/luoshengyang/article/details/39533503)
* [Android运行时ART加载OAT文件的过程分析](http://blog.csdn.net/luoshengyang/article/details/39307813)























