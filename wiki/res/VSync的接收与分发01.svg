<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="9782px" height="1676px" viewBox="-0.5 -0.5 9782 1676" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-11-01T01:55:51.336Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot; etag=&quot;rBqe7ZxeAi1SXls-HE3b&quot; version=&quot;20.5.1&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;3DulHgM3GVHq9iDLcP9_&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-4864-983-132-20-0"><rect x="4864" y="983" width="132" height="20"/></clipPath><clipPath id="mx-clip-4864-1003-132-20-0"><rect x="4864" y="1003" width="132" height="20"/></clipPath><clipPath id="mx-clip-5044-983-202-20-0"><rect x="5044" y="983" width="202" height="20"/></clipPath><clipPath id="mx-clip-5044-1003-202-20-0"><rect x="5044" y="1003" width="202" height="20"/></clipPath></defs><g><rect x="4840" y="903" width="640" height="140" fill="#f5f5f5" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 642px; height: 1px; padding-top: 908px; margin-left: 4840px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【说明信息】</div></div></div></foreignObject><text x="4840" y="920" fill="#333333" font-family="Helvetica" font-size="12px">【说明信息】</text></switch></g><rect x="5480" y="463" width="630" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 632px; height: 1px; padding-top: 473px; margin-left: 5480px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】surfaceflinger@???：IPC from com.blackshark.mola@main</div></div></div></foreignObject><text x="5480" y="477" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】surfaceflinger@???：IPC from com.blackshark.mola@main</text></switch></g><rect x="0" y="463" width="620" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 622px; height: 1px; padding-top: 473px; margin-left: 0px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】com.blackshark.mola@main：APP所在进程</div></div></div></foreignObject><text x="0" y="477" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】com.blackshark.mola@main：APP所在进程</text></switch></g><rect x="0" y="483" width="620" height="340" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 617px; height: 1px; padding-top: 483px; margin-left: 5px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="consolas"><font color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java</span><span style="font-size: 8.3pt;"><i style=""><br /></i></span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public final class </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">Choreographer {<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private static final </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">String </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TAG </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"Choreographer"</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /></span></font><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">    ...<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// Thread local storage for the choreographer.<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private static final </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">ThreadLocal&lt;Choreographer&gt; </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">sThreadInstance </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">=<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">ThreadLocal&lt;Choreographer&gt;() {<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 0);">@Override<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 0);">        </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">protected </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">Choreographer initialValue() {<br />            Looper looper = Looper.</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; font-style: italic;">myLooper</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">();<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(looper == </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">null</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">throw new </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">IllegalStateException(</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"The current thread must have a looper!"</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            }<br /></span><span style="font-size: 11.0667px;"><i><font color="#ff3333">            // VSYNC_SOURCE_APP 代表 APP 层请求的 VSYNC，<br />            // VSYNC_SOURCE_SURFACE_FLINGER 代表 SurfaceFlinger 层请求的 VSYNC<br /></font></i></span><span style="font-size: 8.3pt;">            Choreographer choreographer = </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">Choreographer</span><span style="background-color: rgb(255, 255, 255);">(looper, </span></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">VSYNC_SOURCE_APP</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(looper == Looper.</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; font-style: italic;">getMainLooper</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">()) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-style: italic;">mMainInstance </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= choreographer;<br />            }<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">return </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">choreographer;<br />        }<br />    };</span></font></font></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="5" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.javapublic final class C...</text></switch></g><rect x="680" y="483" width="570" height="300" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 567px; height: 1px; padding-top: 483px; margin-left: 685px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="consolas"><font color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">Choreographer(Looper looper, </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mLooper </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= looper;                    </span><span style="font-size: 11.0667px;"><font color="#ff3333" style=""><i>// UI 线程 looper</i></font></span><span style="font-size: 8.3pt;"><br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHandler </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">FrameHandler(looper);<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mDisplayEventReceiver </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255);"><span style="color: rgb(102, 14, 122); font-size: 8.3pt;"><b><i>USE_VSYNC    </i></b></span><span style="font-size: 11.0667px;"><font color="#ff3333"><i>// USE_VSYNC = true</i></font></span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;"><b><i><br /></i></b></span></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">            </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">FrameDisplayEventReceiver</span><span style="background-color: rgb(255, 255, 255);">(looper, vsyncSource)<br />            : </span></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">null</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mLastFrameTimeNanos </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= Long.</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">MIN_VALUE</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /></span><span style="font-size: 11.0667px;"><i><font color="#ff3333">    // Android 默认 60FPS，mFrameIntervalNanos 为 16.6<br /></font></i></span><span style="font-size: 8.3pt;">    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mFrameIntervalNanos </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= (</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)(</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 255);">1000000000 </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">/ </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; font-style: italic;">getRefreshRate</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">());<br /></span><span style="font-size: 11.0667px;"><i><font color="#ff3333">    // 初始化五种类型的 CallbackQueue 数组<br /></font></i></span><span style="font-size: 8.3pt;">    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mCallbackQueues </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">CallbackQueue[</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">CALLBACK_LAST </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 255);">1</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">];<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">for </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">i = </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 255);">0</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; i &lt;= </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">CALLBACK_LAST</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; i++) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mCallbackQueues</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">[i] = </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">CallbackQueue();<br />    }<br /></span><span style="font-size: 11.0667px;"><i><font color="#ff3333">    // 此为新增特性，适配低帧率设备<br /></font></i></span><span style="font-size: 8.3pt;">    </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// b/68769804: For low FPS experiments.<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">    </span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">setFPSDivisor(SystemProperties.</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; font-style: italic;">getInt</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ThreadedRenderer.</span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">DEBUG_FPS_DIVISOR</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 255);">1</span><font style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">));<br />}</span></font></font></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="685" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.javaprivate Chor...</text></switch></g><path d="M 390 718 Q 420 718 535 600.5 Q 650 483 673.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 678.88 483 L 671.88 486.5 L 673.63 483 L 671.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="385" cy="718" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="1320" y="483" width="570" height="130" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 567px; height: 1px; padding-top: 483px; margin-left: 1325px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private final class </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">FrameDisplayEventReceiver </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">extends </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">implements </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">Runnable {<br />    <font color="#000080"><b>...</b></font></span></font><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">FrameDisplayEventReceiver(Looper looper, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource) {<br />        </span></font><span style="font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold; background-color: rgb(204, 204, 204);">super</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(looper, vsyncSource, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 255);">0</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    }</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1325" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.javaprivate fina...</text></switch></g><path d="M 970 568 Q 1000 568 1145 525.5 Q 1290 483 1313.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1318.88 483 L 1311.88 486.5 L 1313.63 483 L 1311.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="965" cy="568" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="1330" y="613" width="620" height="290" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 617px; height: 1px; padding-top: 613px; margin-left: 1335px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="consolas" style=""><font color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;"><i style="">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\DisplayEventReceiver.java</i></span><span style="font-size: 8.3pt;"><i style=""><br /></i></span></font><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">DisplayEventReceiver(Looper looper, </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">vsyncSource, </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">eventRegistration) {<br />    </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">(looper == </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">null</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">) {<br />        </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">throw new </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">IllegalArgumentException(</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"looper must not be null"</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">);<br />    }<br /><br />    </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mMessageQueue </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">= looper.getQueue();<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i><font color="#ff3333">    // mReceiverPtr 保存了与 SF 通信的对象<br />    // mReceiverPtr 调用路径：<br />    // -&gt;NativeDisplayEventReceiver<br />    // -&gt;DisplayEventDispatcher<br />    // -&gt;DisplayEventReceiver<br />    // -&gt;IDisplayEventConnection（即SF中EventThreadConnection对象的BP端）<br />    // <br />    // mMessageQueue 是主线程中的队列，Native 用其 Looper 对象监听 epoll 事件<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mReceiverPtr </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">= </span><span style="font-size: 8.3pt; font-style: italic; background-color: rgb(204, 204, 204);">nativeInit</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">WeakReference&lt;DisplayEventReceiver&gt;(</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">this</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">), </span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mMessageQueue</span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;">,<br />            vsyncSource, eventRegistration);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1335" y="625" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\DisplayEventReceiver.javapublic Displa...</text></switch></g><rect x="2000" y="483" width="680" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 483px; margin-left: 2005px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">jlong </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">nativeInit</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(JNIEnv* env, jclass </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">clazz</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, jobject receiverWeak, jobject messageQueueObj,<br />                        jint vsyncSource, jint eventRegistration) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">MessageQueue</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">messageQueue </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= android_os_MessageQueue_getMessageQueue(env, messageQueueObj);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">messageQueue </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">== </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NULL</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        jniThrowRuntimeException(env, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"MessageQueue is not initialized."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">NativeDisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">receiver </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">=<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">new </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">NativeDisplayEventReceiver</span><span style="background-color: rgb(255, 255, 255);">(env, receiverWeak, messageQueue, vsyncSource,<br />                                           eventRegistration);<br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">receiver</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">initialize</span><span style="background-color: rgb(255, 255, 255);">();<br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">String8 </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">message</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">message</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.appendFormat(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to initialize display event receiver.  status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        jniThrowRuntimeException(env, message.string());<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">receiver</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">incStrong(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">gDisplayEventReceiverClassInfo</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.clazz); </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// retain a reference for the object<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return reinterpret_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;jlong&gt;(receiver.get());<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2005" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cppstatic jlong nativeInit(J...</text></switch></g><path d="M 1530 848 Q 1560 848 1765 665.5 Q 1970 483 1993.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1998.88 483 L 1991.88 486.5 L 1993.63 483 L 1991.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 513px; margin-left: 1950px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Consolas; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">JNI Call</div></div></div></foreignObject><text x="1950" y="517" fill="rgb(0, 0, 0)" font-family="Consolas" font-size="11px" text-anchor="middle">JNI Call</text></switch></g><ellipse cx="1525" cy="848" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2720" y="483" width="680" height="290" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 483px; margin-left: 2725px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">NativeDisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">NativeDisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(JNIEnv* env, jobject receiverWeak,<br />                                                       </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">MessageQueue</span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">&gt;&amp; messageQueue,<br />                                                       jint vsyncSource, jint eventRegistration)<br />      : </span><span style="background-color: rgb(204, 204, 204);">DisplayEventDispatcher</span><span style="background-color: rgb(255, 255, 255);">(messageQueue-&gt;getLooper(),<br /></span></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">                               // 将 VSYNC_SOURCE_APP 强转为 ISurfaceComposer::VsyncSource 枚举类型<br />                               // class ISurfaceComposer: public IInterface {<br />                               //     enum VsyncSource {<br />                               //         eVsyncSourceApp = 0,<br />                               //         eVsyncSourceSurfaceFlinger = 1<br />                               //     };<br />                               // }<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">                               </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;ISurfaceComposer::VsyncSource&gt;(vsyncSource),<br />                               </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;ISurfaceComposer::EventRegistration&gt;(eventRegistration)),<br />        mReceiverWeakGlobal(env-&gt;NewGlobalRef(receiverWeak)),<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mMessageQueue</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(messageQueue) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"receiver %p ~ Initializing display event receiver."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2725" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cppNativeDisplayEventReceive...</text></switch></g><path d="M 2280 648 Q 2310 648 2500 565.5 Q 2690 483 2713.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2718.88 483 L 2711.88 486.5 L 2713.63 483 L 2711.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2275" cy="648" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="3440" y="483" width="640" height="160" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 483px; margin-left: 3445px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Looper</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;&amp; looper, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncSource </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">eventRegistration)<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">      // vsyncSource 作为参数传给 mReceiver 对象构造函数<br /><br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">      : </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mLooper</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">(looper), </span><span style="background-color: rgb(204, 204, 204);">mReceiver</span><span style="background-color: rgb(255, 255, 255);">(vsyncSource, eventRegistration), </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mWaitingForVsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">false</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ Initializing display event dispatcher."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="3445" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cppDisplayEventDispatcher::Dis...</text></switch></g><path d="M 2920 558 Q 2950 558 3180 520.5 Q 3410 483 3433.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 3438.88 483 L 3431.88 486.5 L 3433.63 483 L 3431.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2915" cy="558" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="4120" y="483" width="660" height="270" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 657px; height: 1px; padding-top: 483px; margin-left: 4125px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncSource </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">eventRegistration) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">sf</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">::</span><span style="background-color: rgb(204, 204, 204);">getComposerService</span><span style="background-color: rgb(255, 255, 255);">());<br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">sf </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">!= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">) {<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // 从 SurfaceFlinger返回 EventThreadConnection 的 Bp 端，即 BpDisplayEventConnection 对象，<br />        // 对端 SF 进程中，EventThreadConnection 作为服务端，继承自 BnDisplayEventConnection<br /><br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventConnection </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">sf</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">createDisplayEventConnection</span><span style="background-color: rgb(255, 255, 255);">(vsyncSource, eventRegistration);<br />        </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventConnection </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">!= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">) {<br />            mDataChannel = std::make_unique&lt;gui::BitTube&gt;();<br /><br />            mEventConnection-&gt;</span><span style="background-color: rgb(204, 204, 204);">stealReceiveChannel</span><span style="background-color: rgb(255, 255, 255);">(mDataChannel.get());<br />        }<br />    }<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4125" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cppDisplayEventReceiver::DisplayEven...</text></switch></g><path d="M 3710 588 Q 3740 588 3915 535.5 Q 4090 483 4113.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4118.88 483 L 4111.88 486.5 L 4113.63 483 L 4111.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="3705" cy="588" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="4840" y="3" width="640" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 3px; margin-left: 4845px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\SurfaceComposerClient.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">/*static*/ </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">getComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">() {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">instance </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::getInstance();<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Mutex</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Autolock </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">_l</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">instance</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mLock</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">instance</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">== </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">::getInstance().</span><span style="background-color: rgb(204, 204, 204);">connectLocked</span><span style="background-color: rgb(255, 255, 255);">()) {<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGD</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"ComposerService reconnected"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">WindowInfosListenerReporter</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::getInstance()</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">reconnect(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">instance</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        }<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">instance</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4845" y="15" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\SurfaceComposerClient.cpp/*static*/ sp&lt;ISurfaceCompos...</text></switch></g><path d="M 4540 558 Q 4570 558 4690 280.5 Q 4810 3 4833.63 3" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4838.88 3 L 4831.88 6.5 L 4833.63 3 L 4831.88 -0.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="4535" cy="558" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="5520" y="3" width="550" height="420" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 547px; height: 1px; padding-top: 3px; margin-left: 5525px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\SurfaceComposerClient.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">bool </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">connectLocked</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">() {<br />    </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">String16 </span><span style="color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">name</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"SurfaceFlinger"</span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">);<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // 获取 SurfaceFlinger 服务并保存在 ComposerService 的 mComposerService 中，<br />    // 此处获取的是 SurfaceFlinger 的 Bp 端 BpSurfaceComposer，<br />    // SurfaceFlinger 的是它的 Bn 端 BnSurfaceComposer 的子类<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">= </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">waitForService&lt;</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&gt;(</span></font><span style="color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">name</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">== </span><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return false</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">; </span></font><span style="color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// fatal error or permission problem<br /></span><span style="color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">}<br /><br />    </span></font><span style="color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Create the death listener.<br /></span><span style="color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">class </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DeathObserver </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">: </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">public </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IBinder</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DeathRecipient </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">{<br />        </span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&amp; </span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">;<br />        </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">virtual void </span><span style="color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">binderDied</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">wp</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&lt;</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IBinder</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&gt;&amp; who) {<br />            </span></font><span style="color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"ComposerService remote (surfaceflinger) died [%p]"</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">,<br />                  who.unsafe_get());<br />            </span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">.composerServiceDied();<br />        }<br />     </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">public</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">:<br />        </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">explicit </span><span style="color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">DeathObserver</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&amp; mgr) : </span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">(mgr) { }<br />    };<br /><br />    </span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mDeathObserver </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">= </span><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">new </span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">DeathObserver(*</span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const_cast</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">&lt;</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">*&gt;(</span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">));<br />    </span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IInterface</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">::asBinder(</span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mComposerService</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">)</span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">linkToDeath(</span></font><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mDeathObserver</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return true</span><font color="#080808" face="Consolas, monospace"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="5525" y="15" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\SurfaceComposerClient.cppbool Composer...</text></switch></g><path d="M 5210 88 Q 5240 88 5365 45.5 Q 5490 3 5513.63 3" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 5518.88 3 L 5511.88 6.5 L 5513.63 3 L 5511.88 -0.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="5205" cy="88" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="4840" y="483" width="580" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 577px; height: 1px; padding-top: 483px; margin-left: 4845px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\ISurfaceComposer.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">createDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncSource </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">eventRegistration) </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">override </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Parcel </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">data</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">reply</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">data</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.writeInterfaceToken(<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::getInterfaceDescriptor());<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">data</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.writeInt32(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">int32_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(vsyncSource));<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">data</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.writeUint32(eventRegistration.get());<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= remote()-&gt;</span><span style="background-color: rgb(204, 204, 204);">transact</span><span style="background-color: rgb(255, 255, 255);">(<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BnSurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">CREATE_DISPLAY_EVENT_CONNECTION</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">data</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, &amp;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">reply</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"ISurfaceComposer::createDisplayEventConnection: error performing "<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">                "transaction: %s (%d)"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, strerror(-</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">), -</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">err</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">= </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">interface_cast&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">reply</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.readStrongBinder());<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4845" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\ISurfaceComposer.cppsp&lt;IDisplayEventConnect...</text></switch></g><path d="M 4510 633 Q 4540 633 4675 558 Q 4810 483 4833.63 483" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4838.88 483 L 4831.88 486.5 L 4833.63 483 L 4831.88 479.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="4505" cy="633" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="5480" y="483" width="630" height="360" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 627px; height: 1px; padding-top: 483px; margin-left: 5485px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\ISurfaceComposer.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BnSurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">onTransact</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">code, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Parcel</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; data, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Parcel</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* reply, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">flags)<br />{<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">switch</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(code) {<br />        ...<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">CREATE_DISPLAY_EVENT_CONNECTION: {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">CHECK_INTERFACE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ISurfaceComposer, data, reply);<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">auto </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource = </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;ISurfaceComposer::VsyncSource&gt;(data.readInt32());<br />            EventRegistrationFlags eventRegistration =<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">&lt;EventRegistration&gt;(data.readUint32());<br /><br />            </span><span style="background-color: rgb(204, 204, 204);">sp&lt;IDisplayEventConnection&gt;</span><span style="background-color: rgb(255, 255, 255);"> connection(<br />                    </span><span style="background-color: rgb(204, 204, 204);">createDisplayEventConnection</span><span style="background-color: rgb(255, 255, 255);">(vsyncSource, eventRegistration));<br />            reply-&gt;writeStrongBinder(IInterface::asBinder(connection));<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br />        ...<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">default</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">BBinder::onTransact(code, data, reply, flags);<br />        }<br />    }<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="5485" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\ISurfaceComposer.cppstatus_t BnSurfaceComposer::onTr...</text></switch></g><path d="M 5030 678 Q 5060 678 5255 580.5 Q 5450 483 5473.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 5478.88 483 L 5471.88 486.5 L 5473.63 483 L 5471.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 580px; margin-left: 5255px;"><div data-drawio-colors="color: #FF3333; background-color: #FFFF00; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Consolas; color: rgb(255, 51, 51); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 0); white-space: nowrap;"><font>IPC 调用</font></div></div></div></foreignObject><text x="5255" y="584" fill="#FF3333" font-family="Consolas" font-size="11px" text-anchor="middle">IPC 调用</text></switch></g><ellipse cx="5025" cy="678" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6160" y="483" width="680" height="170" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 483px; margin-left: 6165px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\SurfaceFlinger.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">SurfaceFlinger</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">createDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncSource </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">eventRegistration) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // vsyncSource = eVsyncSourceApp == 0，即为应用层请求的 Vsync<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const auto</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">handle </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">=<br />            vsyncSource == </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">eVsyncSourceSurfaceFlinger </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mSfConnectionHandle </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mAppConnectionHandle</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mScheduler</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">createDisplayEventConnection</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">handle</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, eventRegistration);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6165" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\SurfaceFlinger.cppsp&lt;IDisplayEventConnection&gt;...</text></switch></g><path d="M 5800 688 Q 5830 688 5980 585.5 Q 6130 483 6153.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6158.88 483 L 6151.88 486.5 L 6153.63 483 L 6151.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="5795" cy="688" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6880" y="483" width="640" height="160" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 483px; margin-left: 6885px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">IDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Scheduler</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">createDisplayEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ConnectionHandle </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">handle, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">eventRegistration) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">std</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">lock_guard</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">std</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">mutex</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">lock</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mConnectionsLock</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">RETURN_IF_INVALID_HANDLE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(handle, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">);<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // 在创建 mSfConnectionHandle 和 mAppConnectionHandle 对象时，会将其放到 mConnections 容器中<br />    // 这里复用了 app 的 EventThread 对象，目的是为了复用 EventThread 对象中的<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">createConnectionInternal</span><span style="background-color: rgb(255, 255, 255);">(mConnections[handle].thread.get(), eventRegistration);<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6885" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cppsp&lt;IDisplayEven...</text></switch></g><path d="M 6500 618 Q 6530 618 6690 550.5 Q 6850 483 6873.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6878.88 483 L 6871.88 486.5 L 6873.63 483 L 6871.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="6495" cy="618" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="7560" y="483" width="650" height="100" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 647px; height: 1px; padding-top: 483px; margin-left: 7565px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><span style="background-color: rgb(255, 255, 255);"><font face="Consolas, monospace"><span style="font-size: 11.0667px;"><font color="#cccccc">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cpp</font></span><span style="font-size: 8.3pt;"><font color="#cccccc"><br /></font><font color="#008080">sp</font></span></font></span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">&lt;</span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">EventThreadConnection</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">&gt; </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">Scheduler</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">::</span><span style="color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">createConnectionInternal</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">(<br />        </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">EventThread</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">* eventThread, </span><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">ISurfaceComposer</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">::</span><span style="color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">EventRegistrationFlags </span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">eventRegistration) {<br />    </span><span style="color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">return </span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">eventThread-&gt;</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(204, 204, 204);">createEventConnection</span><span style="color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 255, 255);">([&amp;] { resync(); }, eventRegistration);<br />}</span></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="7565" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cppsp&lt;EventThreadCon...</text></switch></g><path d="M 7110 598 Q 7140 598 7335 540.5 Q 7530 483 7553.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 7558.88 483 L 7551.88 486.5 L 7553.63 483 L 7551.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="7105" cy="598" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="7570" y="583" width="640" height="140" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 583px; margin-left: 7575px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThread</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">createEventConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ResyncCallback </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">resyncCallback,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">eventRegistration) </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return new </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">EventThreadConnection</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;EventThread*&gt;(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">),<br />                                     IPCThreadState::self()-&gt;getCallingUid(),<br />                                     std::move(resyncCallback), eventRegistration);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="7575" y="595" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cppsp&lt;EventThrea...</text></switch></g><rect x="8280" y="483" width="640" height="200" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 483px; margin-left: 8285px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThread</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* eventThread, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uid_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">callingUid, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ResyncCallback </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">resyncCallback,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventRegistrationFlags </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">eventRegistration)<br />      : </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">resyncCallback</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">std</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::move(resyncCallback)),<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mOwnerUid</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(callingUid),<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventRegistration</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(eventRegistration),<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventThread</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">(eventThread),<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // EventThread.h<br />        //     gui::BitTube mChannel;<br />        // gui::BitTube::DefaultSize = 4KB<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">        </span><span style="background-color: rgb(204, 204, 204);">mChannel</span><span style="background-color: rgb(255, 255, 255);">(gui::BitTube::DefaultSize) {}</span></span></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="8285" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cppEventThreadCo...</text></switch></g><path d="M 7810 663 Q 7840 663 8045 573 Q 8250 483 8273.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 8278.88 483 L 8271.88 486.5 L 8273.63 483 L 8271.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="7805" cy="663" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="8960" y="483" width="820" height="470" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 817px; height: 1px; padding-top: 483px; margin-left: 8965px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><pre style=""><pre style=""><pre style=""><pre style=""><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><font color="#cccccc">// frameworks\native\libs\gui\BitTube.cpp</font></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><div style="font-family: monospace;"><i><font color="#ff0000"><font style="font-family: Consolas, &quot;Courier New&quot;, monospace;">// </font><span style="background-color: initial;"><font face="Verdana">init 函数主要是通过 socketpair 函数创建一对 socket</font></span></font></i></div></div><div style=""><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">void</span><font face="Consolas, Courier New, monospace"> BitTube::init(</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">size_t</span><font face="Consolas, Courier New, monospace"> rcvbuf, </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">size_t</span><font face="Consolas, Courier New, monospace"> sndbuf) {<br /></font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    </span><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">int</span><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"> </span><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(106, 62, 62);">sockets</span><font face="Consolas, Courier New, monospace">[2];<br /></font><div><font color="#ff0000"><i style=""><font face="Consolas, Courier New, monospace" style="">    // </font></i><font face="Verdana"><i>socketpair() 函数用于创建一对无名的、相互连接的 socket</i></font></font></div><div><font color="#ff0000"><i><font face="Consolas, Courier New, monospace">    // </font></i><font face="Verdana"><i>如果成功，则返回0，创建好的 socket 分别是 sv[0] 和 sv[1]；否则返回-1</i></font></font></div><div><div><i><font color="#ff0000"><font face="Consolas, Courier New, monospace">    // </font><font face="Verdana">说明：</font></font></i></div></div><div><font color="#ff0000"><i><font face="Consolas, Courier New, monospace">    // </font><font face="Verdana">1. </font></i><font face="Verdana"><i>这对 socket 是全双工通信，每一个 socket 既可以读也可以写。如：往 sv[0] 中写，从 sv[1] 中读；或往 sv[1] 中写，从 sv[0] 中读。</i></font></font></div><div><font color="#ff0000"><i><font face="Consolas, Courier New, monospace">    // </font><font face="Verdana">2. 如果写入</font></i><font face="Verdana"><i>一个 socket(如 sv[0])后，再从该 socket 读取时，会被阻塞，只能从另一个 socket (sv[1])上</i><i>读取</i></font><i style="font-family: Verdana;">。</i></font></div><div><font color="#ff0000"><i><font face="Consolas, Courier New, monospace">    // </font><font face="Verdana">3. </font></i><font face="Verdana"><i>读、写操作可以位于同一个进程，也可以分别位于不同的进程。</i></font></font></div><div></div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    </span><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">if</span><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"> (socketpair(AF_UNIX, SOCK_SEQPACKET, 0, sockets) == 0) {</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        <span style="color: #7f0055;font-weight: bold;">size_t</span> size = DEFAULT_SOCKET_BUFFER_SIZE;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        setsockopt(<span style="color: #6a3e3e;">sockets</span>[0], SOL_SOCKET, SO_RCVBUF, &amp;rcvbuf, <span style="color: #7f0055;font-weight: bold;">sizeof</span>(rcvbuf));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        setsockopt(<span style="color: #6a3e3e;">sockets</span>[1], SOL_SOCKET, SO_SNDBUF, &amp;sndbuf, <span style="color: #7f0055;font-weight: bold;">sizeof</span>(sndbuf));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="color: #3f7f5f;">        // since we don't use the "return channel", we keep it small...</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        setsockopt(<span style="color: #6a3e3e;">sockets</span>[0], SOL_SOCKET, SO_SNDBUF, &amp;size, <span style="color: #7f0055;font-weight: bold;">sizeof</span>(size));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        setsockopt(<span style="color: #6a3e3e;">sockets</span>[1], SOL_SOCKET, SO_RCVBUF, &amp;size, <span style="color: #7f0055;font-weight: bold;">sizeof</span>(size));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        fcntl(<span style="color: #6a3e3e;">sockets</span>[0], F_SETFL, O_NONBLOCK);</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        fcntl(<span style="color: #6a3e3e;">sockets</span>[1], F_SETFL, O_NONBLOCK);<br /></div><div><font color="#ff0000"><i style=""><font face="Consolas, Courier New, monospace" style="">        // </font></i><font face="Verdana"><span style="background-color: initial;"><i>建立Fd与socket的关联，</i></span><span style="background-color: initial;"><i>VSync 到来的时候通过 mSendFd 写入消息，然后 app 监听 mReceiveFd 接受 VSync 消息，</i></span></font></font></div><font color="#ff0000"><span style="font-family: Consolas, &quot;Courier New&quot;, monospace;"></span></font><div><font color="#ff0000"><i><font face="Consolas, Courier New, monospace">        // </font></i><span style="background-color: initial;"><font face="Verdana"><i>此时的 mReceiveFd 依然还在 SurfaceFlinger 进程中，还没有和 app 进程建立联系</i></font></span></font></div><font color="#ff0000"><span style="font-family: Consolas, &quot;Courier New&quot;, monospace;"></span></font><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        <span style="color: #6a3e3e;">mReceiveFd</span>.reset(<span style="color: #6a3e3e;">sockets</span>[0]);</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        <span style="color: #6a3e3e;">mSendFd</span>.reset(<span style="color: #6a3e3e;">sockets</span>[1]);</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    } <span style="color: #7f0055;font-weight: bold;">else</span> {</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        <span style="color: #6a3e3e;">mReceiveFd</span>.reset();</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">        ALOGE(<span style="color: #2a00ff;">"BitTube: pipe creation failed (</span><span style="color: #6a3e3e;">%s</span><span style="color: #2a00ff;">)"</span>, strerror(errno));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    }</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">}</div></div></div></div></div></div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="8965" y="495" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// frameworks\native\libs\gui\BitTube.cpp...</text></switch></g><rect x="8290" y="683" width="440" height="80" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 437px; height: 1px; padding-top: 683px; margin-left: 8295px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">bufsize) {<br />    </span><span style="background-color: rgb(204, 204, 204);">init</span><span style="background-color: rgb(255, 255, 255);">(bufsize, bufsize);<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="8295" y="695" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cppBitTube::...</text></switch></g><path d="M 8350 728 Q 8380 728 8655 605.5 Q 8930 483 8953.63 483" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 8958.88 483 L 8951.88 486.5 L 8953.63 483 L 8951.88 479.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="8345" cy="728" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6160" y="723" width="640" height="120" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 723px; margin-left: 6165px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><div style="line-height: 16px;"><div style=""><div style="line-height: 16px;"><div style="line-height: 16px;"><div style="background-color: rgb(255, 255, 255); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><font color="#cccccc">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</font></div><div style="background-color: rgb(255, 255, 255); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="color: #7f0055;font-weight: bold;">void</span> EventThreadConnection::onFirstRef() {</div><div style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(63, 127, 95);">    // NOTE: mEventThread doesn't hold a strong reference on us<br /></span><i style=""><font color="#ff0000"><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    // </span><font face="Verdana" style=""><span style="font-size: 12px;">将创建的 </span>EventThreadConnection 对象保存到 mAppConnectionHandle 对应的 mEventThread 中</font></font></i></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(106, 62, 62);">mEventThread</span><span style="background-color: rgb(255, 255, 255);">-&gt;</span><span style="background-color: rgb(204, 204, 204);">registerDisplayEventConnection</span><span style="background-color: rgb(255, 255, 255);">(</span><span style="background-color: rgb(255, 255, 255); color: rgb(106, 62, 62);">this</span><span style="background-color: rgb(255, 255, 255);">);</span></div><div style="background-color: rgb(255, 255, 255); font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">}</div></div></div></div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6165" y="735" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 5740 673 Q 5770 673 5950 698 Q 6130 723 6153.63 723" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6158.88 723 L 6151.88 726.5 L 6153.63 723 L 6151.88 719.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="5735" cy="673" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6840" y="723" width="680" height="350" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 723px; margin-left: 6845px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><div style="line-height: 16px;"><div style=""><div style="line-height: 16px;"><div style="line-height: 16px;"><div style=""><div style="line-height: 16px;"><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><span style="color: rgb(63, 127, 95);"><font face="consolas">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</font></span></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">status_t EventThread::registerDisplayEventConnection(<span style="color: #7f0055;font-weight: bold;">const</span> sp&lt;EventThreadConnection&gt;<span style="color: #7f0055;font-weight: bold;">&amp;</span> connection) {</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    std::lock_guard&lt;std::mutex&gt; lock(mMutex);</font></div><span style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas"><br /></font></span><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas"><font color="#3f7f5f" style="">    // this should never happen<br /></font><i style=""><font color="#ff0000">    // 去重，防止重复保存连接对象</font></i></font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    <span style="color: #7f0055;font-weight: bold;">auto</span> <span style="color: #6a3e3e;">it</span> = std::find(<span style="color: #6a3e3e;">mDisplayEventConnections</span>.cbegin(),</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">            <span style="color: #6a3e3e;">mDisplayEventConnections</span>.cend(), connection);</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    <span style="color: #7f0055;font-weight: bold;">if</span> (<span style="color: #6a3e3e;">it</span> != <span style="color: #6a3e3e;">mDisplayEventConnections</span>.cend()) {</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">        ALOGW(<span style="color: #2a00ff;">"DisplayEventConnection </span><span style="color: #6a3e3e;">%p</span><span style="color: #2a00ff;"> already exists"</span>, connection.get());</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">        <span style="color: #6a3e3e;">mCondition</span>.notify_all();</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">        <span style="color: #7f0055;font-weight: bold;">return</span> ALREADY_EXISTS;</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    }</font></div><span style="background-color: rgb(255, 255, 255);"><font face="consolas" style=""><br /><i style=""><font color="#ff0000" style="">    // 每个客户端连接保存到 mAppConnectionHandle 对应 EventThread 的 mDisplayEventConnections 变量中<br />    // VSync 信号通过 </font></i></font></span><span style="background-color: initial;"><font color="#ff0000" face="consolas"><i>EventThread::mDisplayEventConnections </i></font></span><i style="font-family: consolas; background-color: rgb(255, 255, 255);"><font color="#ff0000">集合分发给各个客户端</font></i></div><div style="line-height: 16px;"><div style="font-size: 12px;"><font face="consolas">    <span style="background-color: rgb(255, 255, 0);"><span style="color: rgb(106, 62, 62);">mDisplayEventConnections</span>.push_back</span>(connection);</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    <span style="color: #6a3e3e;">mCondition</span>.notify_all();</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">    <span style="color: #7f0055;font-weight: bold;">return</span> NO_ERROR;</font></div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="consolas">}</font></div></div></div></div></div></div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6845" y="735" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 6480 808 Q 6510 808 6660 765.5 Q 6810 723 6833.63 723" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6838.88 723 L 6831.88 726.5 L 6833.63 723 L 6831.88 719.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="6475" cy="808" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><path d="M 4440 688 Q 4470 688 4640 865.5 Q 4810 1043 4833.63 1043" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4838.88 1043 L 4831.88 1046.5 L 4833.63 1043 L 4831.88 1039.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 865px; margin-left: 4640px;"><div data-drawio-colors="color: #FF3333; background-color: #FFFF00; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Consolas; color: rgb(255, 51, 51); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 0); white-space: nowrap;"><span style="font-size: 11px;">IPC 调用</span></div></div></div></foreignObject><text x="4640" y="868" fill="#FF3333" font-family="Consolas" font-size="11px" text-anchor="middle">IPC 调用</text></switch></g><ellipse cx="4435" cy="688" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="4840" y="883" width="640" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 642px; height: 1px; padding-top: 893px; margin-left: 4840px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】surfaceflinger@???：IPC from com.blackshark.mola@main</div></div></div></foreignObject><text x="4840" y="897" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】surfaceflinger@???：IPC from com.blackshark.mola@main</text></switch></g><rect x="4850" y="933" width="160" height="100" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 158px; height: 1px; padding-top: 940px; margin-left: 4851px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">SF</div></div></div></foreignObject><text x="4930" y="952" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">SF</text></switch></g><rect x="5030" y="933" width="230" height="100" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 228px; height: 1px; padding-top: 940px; margin-left: 5031px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">APP</div></div></div></foreignObject><text x="5145" y="952" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">APP</text></switch></g><path d="M 5000 993 Q 5000 993 5033.63 993" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 5038.88 993 L 5031.88 996.5 L 5033.63 993 L 5031.88 989.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 5000 1013 Q 5000 1013 5033.63 1013" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 5038.88 1013 L 5031.88 1016.5 L 5033.63 1013 L 5031.88 1009.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 4860 983 L 4860 963 L 5000 963 L 5000 983" fill="#eeeeee" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><path d="M 4860 983 L 4860 1023 L 5000 1023 L 5000 983" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="none"/><path d="M 4860 983 L 5000 983" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" text-anchor="middle" font-size="12px"><text x="4929.5" y="977.5">mChannel</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-4864-983-132-20-0)" font-size="12px"><text x="4865.5" y="997.5">mReceiveFd=sockets[0]</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-4864-1003-132-20-0)" font-size="12px"><text x="4865.5" y="1017.5">mSendFd=sockets[1]</text></g><path d="M 5040 983 L 5040 963 L 5250 963 L 5250 983" fill="#eeeeee" stroke="#36393d" stroke-miterlimit="10" pointer-events="none"/><path d="M 5040 983 L 5040 1023 L 5250 1023 L 5250 983" fill="none" stroke="#36393d" stroke-miterlimit="10" pointer-events="none"/><path d="M 5040 983 L 5250 983" fill="none" stroke="#36393d" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" text-anchor="middle" font-size="12px"><text x="5144.5" y="977.5">mDataChannel</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-5044-983-202-20-0)" font-size="12px"><text x="5045.5" y="997.5">mReceiveFd=mChannel.mReceiveFd</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-5044-1003-202-20-0)" font-size="12px"><rect fill="rgb(255, 255, 255)" stroke="none" x="5046" y="1007" width="199" height="15" stroke-width="0"/><text x="5045.5" y="1017.5">mSendFd=dup(mChannel.mSendFd)</text></g><rect x="4840" y="1043" width="640" height="150" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 1043px; margin-left: 4845px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><pre style=""><pre style=""><pre style=""><pre style=""><div style="line-height: 16px;"><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><font color="#cccccc">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</font></div><div style="font-size: 12px;"><font face="Consolas, Courier New, monospace">status_t EventThreadConnection::stealReceiveChannel(gui::BitTube</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; color: rgb(127, 0, 85); font-weight: bold;">*</span><font face="Consolas, Courier New, monospace"> outChannel) {<br /></font><i style=""><font color="#ff0000"><font face="Consolas, Courier New, monospace" style="">    // </font><font face="Verdana" style="">将 SF 进程中 BitTube 的 mReceiveFd 传到 app 进程中，建立 SF 和 APP 的通信信道</font></font></i></div><div style=""><font face="Consolas, Courier New, monospace">    </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(106, 62, 62);">outChannel</span><font face="Consolas, Courier New, monospace">-&gt;setReceiveFd(</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(106, 62, 62);">mChannel</span><font face="Consolas, Courier New, monospace">.moveReceiveFd());<br /></font><i style=""><font color="#ff0000"><font face="Consolas, Courier New, monospace" style="">    // </font><font face="Verdana" style="">将 SF 进程中 BitTube 的 mSendFd 复制一份传到 app 进程中，让 APP 也可以模拟发送 VSync 信号</font><font face="Consolas, Courier New, monospace" style=""><br /></font></font></i></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    <span style="color: #6a3e3e;">outChannel</span>-&gt;setSendFd(base::unique_fd(dup(<span style="color: #6a3e3e;">mChannel</span>.getSendFd())));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">    <span style="color: #7f0055;font-weight: bold;">return</span> NO_ERROR;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;">}</div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4845" y="1055" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><rect x="2720" y="803" width="600" height="300" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 597px; height: 1px; padding-top: 803px; margin-left: 2725px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">initialize</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">() {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= mReceiver.</span><span style="background-color: rgb(204, 204, 204);">initCheck</span><span style="background-color: rgb(255, 255, 255);">();<br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to initialize display event receiver, status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">result</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mLooper </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">!= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">) {<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // mReceiver.getFd() 等价于 mDataChannel-&gt;getFd()<br /><br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">rc </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= mLooper-&gt;</span><span style="background-color: rgb(204, 204, 204);">addFd</span><span style="background-color: rgb(255, 255, 255);">(mReceiver.getFd(), </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, Looper::EVENT_INPUT, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NULL</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">rc </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">UNKNOWN_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">OK</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2725" y="815" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cppstatus_t DisplayEvent...</text></switch></g><path d="M 2280 678 Q 2310 678 2500 740.5 Q 2690 803 2713.63 803" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 2718.88 803 L 2711.88 806.5 L 2713.63 803 L 2711.88 799.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="2275" cy="678" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="none"/><rect x="3360" y="803" width="530" height="140" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 527px; height: 1px; padding-top: 803px; margin-left: 3365px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><pre style=""><pre style=""><pre style="font-size: 8.3pt;"><pre style="font-size: 8.3pt;"><div style="font-size: 12px; line-height: 16px;"><div style="line-height: 16px;"><div style="font-family: Consolas, &quot;Courier New&quot;, monospace;"><font color="#cccccc">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp</font></div><div style=""><font face="Consolas, Courier New, monospace">status_t DisplayEventReceiver::initCheck() </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; color: rgb(127, 0, 85); font-weight: bold;">const</span><font face="Consolas, Courier New, monospace"> {<br /></font><i style=""><font color="#ff0000"><font face="Consolas, Courier New, monospace" style="">    // </font><font face="Verdana" style="">检查 APP 端是否已创建 BitTube 对象</font></font></i></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace;">    <span style="color: #7f0055;font-weight: bold;">if</span> (mDataChannel != <span style="color: #0000c0;">nullptr</span>)</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace;">        <span style="color: #7f0055;font-weight: bold;">return</span> NO_ERROR;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace;">    <span style="color: #7f0055;font-weight: bold;">return</span> NO_INIT;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace;">}</div></div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="3365" y="815" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp...</text></switch></g><path d="M 2990 848 Q 3020 848 3175 825.5 Q 3330 803 3353.63 803" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 3358.88 803 L 3351.88 806.5 L 3353.63 803 L 3351.88 799.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="2985" cy="848" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="none"/><rect x="3360" y="963" width="670" height="710" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 667px; height: 1px; padding-top: 963px; margin-left: 3365px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><div style="line-height: 16px;"><div style=""><div style="line-height: 16px;"><div style="background-color: rgb(255, 255, 255);"><font face="Consolas, Courier New, monospace" style=""><font color="#cccccc">// aosp_android-12.1.0_r2\system\core\libutils\Looper.cpp<br /></font><i style="color: rgb(255, 0, 0);">// </i></font><font face="Verdana" style="color: rgb(255, 0, 0); font-style: italic;">Handler消息机制可以处理三种消息，java 层 msg，native 层 msg，以及通过 addFd 创建的 request，</font><font face="Consolas, Courier New, monospace" style="color: rgb(255, 0, 0); font-style: italic;"><br />// </font><font face="Verdana" style="color: rgb(255, 0, 0); font-style: italic;">request 中包含监听的 fd 以及收到消息时的回调 handleEvent,</font><font face="Consolas, Courier New, monospace" style="color: rgb(255, 0, 0); font-style: italic;"><br />// </font><font face="Verdana" style="color: rgb(255, 0, 0); font-style: italic;">DisplayEventDispatcher 是 LooperCallback 的派生类，此处由该对象负责实现 handleEvent </font><font face="Consolas, Courier New, monospace" style="color: rgb(255, 0, 0); font-style: italic;"><br /></font><b style="font-family: Consolas, &quot;Courier New&quot;, monospace; color: rgb(127, 0, 85);">int</b><font face="Consolas, Courier New, monospace"> Looper::addFd(</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">int</span><font face="Consolas, Courier New, monospace"> fd, </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">int</span><font face="Consolas, Courier New, monospace"> ident, </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">int</span><font face="Consolas, Courier New, monospace"> events, </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">const</span><font face="Consolas, Courier New, monospace"> sp&lt;LooperCallback&gt;</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">&amp;</span><font face="Consolas, Courier New, monospace"> callback, </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(127, 0, 85); font-weight: bold;">void*</span><font face="Consolas, Courier New, monospace"> data) {</font></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><font color="#7f0055"><b>    ...</b></font></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    <span style="color: #7f0055;font-weight: bold;">if</span> (!callback.get()) {</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <font color="#7f0055"><b>...</b></font></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    } <span style="color: #7f0055;font-weight: bold;">else</span> {</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        ident = POLL_CALLBACK;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    }</div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><br /></span><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    {<span style="color: #3f7f5f;"> // acquire lock</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        AutoMutex <span style="color: #6a3e3e;">_l</span>(mLock);</div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><br /></span><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        Request <span style="color: #6a3e3e;">request</span>;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.<span style="color: #6a3e3e;">fd</span> = fd;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.<span style="color: #6a3e3e;">ident</span> = ident;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.<span style="color: #6a3e3e;">events</span> = events;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.<span style="color: #6a3e3e;">seq</span> = mNextRequestSeq++;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="background-color: rgb(255, 255, 255);">        </span><span style="background-color: rgb(255, 255, 0);"><span style="color: rgb(106, 62, 62);">request</span>.<span style="color: rgb(106, 62, 62);">callback</span> = callback</span><span style="background-color: rgb(255, 255, 255);">;</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.<span style="color: #6a3e3e;">data</span> = data;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #7f0055;font-weight: bold;">if</span> (mNextRequestSeq == -1) mNextRequestSeq = 0;<span style="color: #3f7f5f;"> // reserve sequence number -1</span></div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><br /></span><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #7f0055;font-weight: bold;">struct</span> epoll_event <span style="color: #6a3e3e;">eventItem</span>;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #6a3e3e;">request</span>.initEventItem(&amp;<span style="color: #6a3e3e;">eventItem</span>);</div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><br /></span><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        <span style="color: #7f0055;font-weight: bold;">ssize_t</span> <span style="color: #6a3e3e;">requestIndex</span> = <span style="color: #6a3e3e;">mRequests</span>.indexOfKey(fd);</div><div style="font-size: 12px; background-color: rgb(255, 255, 255);"><font face="Consolas, Courier New, monospace">        </font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; color: rgb(127, 0, 85); font-weight: bold;">if</span><font face="Consolas, Courier New, monospace"> (</font><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; color: rgb(106, 62, 62);">requestIndex</span><font face="Consolas, Courier New, monospace"> &lt; 0) {<br /></font><i style=""><font color="#ff0000"><font face="Consolas, Courier New, monospace" style="">            // </font><font face="Verdana" style="">EPOLL_CTL_ADD：添加新的 fd 到 epfd 中</font></font></i></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px;"><span style="background-color: rgb(255, 255, 255);">            <span style="color: #7f0055;font-weight: bold;">int</span> <span style="color: #6a3e3e;">epollResult</span> = </span><span style="background-color: rgb(255, 255, 0);">epoll_ctl(<span style="color: rgb(106, 62, 62);">mEpollFd</span>.get(), EPOLL_CTL_ADD, fd, &amp;<span style="color: rgb(106, 62, 62);">eventItem</span>)</span><span style="background-color: rgb(255, 255, 255);">;</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">            <span style="color: #7f0055;font-weight: bold;">if</span> (<span style="color: #6a3e3e;">epollResult</span> &lt; 0) {</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">                ALOGE(<span style="color: #2a00ff;">"Error adding epoll events for fd </span><span style="color: #6a3e3e;">%d</span><span style="color: #2a00ff;">: </span><span style="color: #6a3e3e;">%s</span><span style="color: #2a00ff;">"</span>, fd, strerror(errno));</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">                <span style="color: #7f0055;font-weight: bold;">return</span> -1;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">            }</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">            <span style="color: #6a3e3e;">mRequests</span>.add(fd, <span style="color: #6a3e3e;">request</span>);</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        } <span style="color: #7f0055;font-weight: bold;">else</span> {</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">            <font color="#7f0055"><b>...</b></font></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">        }</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    }<span style="color: #3f7f5f;"> // release lock</span></div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">    <span style="color: #7f0055;font-weight: bold;">return</span> 1;</div><div style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);">}</div><span style="font-family: Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; background-color: rgb(255, 255, 255);"><br /></span></div></div></div></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="3365" y="975" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\system\core\libutils\Looper.cpp...</text></switch></g><path d="M 2930 980.5 Q 2960 980.5 3145 971.75 Q 3330 963 3353.63 963" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 3358.88 963 L 3351.88 966.5 L 3353.63 963 L 3351.88 959.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="2925" cy="980.5" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="none"/><rect x="6730" y="563" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 573px; margin-left: 6731px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-3</div></div></div></foreignObject><text x="6745" y="577" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-3</text></switch></g><rect x="6840" y="983" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 993px; margin-left: 6841px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-7</div></div></div></foreignObject><text x="6855" y="997" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-7</text></switch></g><rect x="930" y="548" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 558px; margin-left: 931px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">1</div></div></div></foreignObject><text x="945" y="562" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1</text></switch></g><rect x="1330" y="838" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 848px; margin-left: 1331px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">2</div></div></div></foreignObject><text x="1345" y="852" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2</text></switch></g><rect x="3660" y="568" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 578px; margin-left: 3661px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-1</div></div></div></foreignObject><text x="3675" y="582" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-1</text></switch></g><rect x="4330" y="608" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 618px; margin-left: 4331px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-2</div></div></div></foreignObject><text x="4345" y="622" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-2</text></switch></g><rect x="4330" y="668" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 678px; margin-left: 4331px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">4</div></div></div></foreignObject><text x="4345" y="682" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">4</text></switch></g><rect x="7230" y="613" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 623px; margin-left: 7231px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-4</div></div></div></foreignObject><text x="7245" y="627" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-4</text></switch></g><rect x="8310" y="648" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 658px; margin-left: 8311px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-5</div></div></div></foreignObject><text x="8325" y="662" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-5</text></switch></g><rect x="8960" y="653" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 663px; margin-left: 8961px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3-6</div></div></div></foreignObject><text x="8975" y="667" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-6</text></switch></g><rect x="4840" y="1093" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1103px; margin-left: 4841px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">4-1</div></div></div></foreignObject><text x="4855" y="1107" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">4-1</text></switch></g><rect x="2890" y="955.5" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 966px; margin-left: 2891px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">5-1</div></div></div></foreignObject><text x="2905" y="969" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">5-1</text></switch></g><rect x="2160" y="648" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 658px; margin-left: 2161px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">3</div></div></div></foreignObject><text x="2175" y="662" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3</text></switch></g><rect x="2230" y="678" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 688px; margin-left: 2231px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">5</div></div></div></foreignObject><text x="2245" y="692" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">5</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>