<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1551px" height="6293px" viewBox="-0.5 -0.5 1551 6293" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2020-06-03T10:07:05.306Z&quot; agent=&quot;5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&quot; etag=&quot;Yrpo3aPCd9gCwhaZMEqB&quot; version=&quot;13.1.11&quot;&gt;&lt;diagram id=&quot;71aa756b-deb0-e7b1-39c7-49fa7107dbdd&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="130" y="1542" width="405" height="170" rx="8.5" ry="8.5" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1549px; margin-left: 132px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#009900">bool is_newest_version</font></div><div>判断当前处理的apex是否为最高版本。</div><div>当扫描目录中有两个以上的apex文件时，<span>如果当前处理的apex版本号小于</span></div><div><span>之前mount上的apex版本号，则该值为false。</span></div><div><span>该值的作用是让系统挂载最新版本的apex。</span></div><div><br /></div><div><font color="#009900"><span>bool found_other_version</span><br /></font></div><div><font color="#009900">bool version_found_mounted</font></div><div>这两个值用于防止重复挂载相同包名。</div><div>当扫描目录中有两个以上的apex文件时，如果版本号相同，那么就不需要</div><div>重新挂载了。</div><br /><div><br /></div></div></div></div></foreignObject><text x="132" y="1561" fill="#000000" font-family="Helvetica" font-size="12px">bool is_newest_version...</text></switch></g><path d="M 0 2 L 80 2 L 90 12 L 80 22 L 0 22 L 10 12 Z" fill="#97d077" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 12px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">boot up</div></div></div></foreignObject><text x="45" y="16" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">boot up</text></switch></g><path d="M 1390 1232 L 1390 42" fill="none" stroke="#bbbbbb" stroke-miterlimit="10" pointer-events="stroke"/><rect x="1400" y="42" width="115" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 113px; height: 1px; padding-top: 52px; margin-left: 1402px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #BBBBBB; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font face="helvetica">-</font></div></div></div></foreignObject><text x="1402" y="56" fill="#BBBBBB" font-family="Helvetica" font-size="12px">-</text></switch></g><rect x="1270" y="42" width="115" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 113px; height: 1px; padding-top: 52px; margin-left: 1270px;"><div style="box-sizing: border-box; font-size: 0; text-align: right; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #BBBBBB; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left"><span>main</span></div></div></div></div></foreignObject><text x="1383" y="56" fill="#BBBBBB" font-family="Helvetica" font-size="12px" text-anchor="end">main</text></switch></g><path d="M 810 622 L 2050 622" fill="none" stroke="#bbbbbb" stroke-width="4" stroke-miterlimit="10" transform="rotate(90,1430,622)" pointer-events="all"/><rect x="1310" y="2" width="115" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-end; width: 113px; height: 1px; padding-top: 12px; margin-left: 1310px;"><div style="box-sizing: border-box; font-size: 0; text-align: right; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #BBBBBB; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="text-align: left">apexd</span></div></div></div></foreignObject><text x="1423" y="16" fill="#BBBBBB" font-family="Helvetica" font-size="12px" text-anchor="end">apexd</text></switch></g><rect x="1435" y="2" width="115" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 113px; height: 1px; padding-top: 12px; margin-left: 1437px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #BBBBBB; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">-</div></div></div></foreignObject><text x="1437" y="16" fill="#BBBBBB" font-family="Helvetica" font-size="12px">-</text></switch></g><path d="M 420 755 L 420 763.5 Q 420 772 430 772 L 473.63 772" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="752" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 772 L 471.88 775.5 L 473.63 772 L 471.88 768.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><path d="M 540 835 L 540 864.5 Q 540 874.5 550 874.5 L 593.63 874.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="540" cy="832" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 598.88 874.5 L 591.88 878 L 593.63 874.5 L 591.88 871 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="752" width="120" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 759px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apex_key.cpp</font><br /></div><div><div><font color="#999999">Status collectApexKeys(bool scanExternalKeys) {</font></div><div><font color="#999999">  for (const auto&amp; dir : kApexPackageBuiltinDirs) {</font></div><div><font color="#999999">    StatusOr&lt;std::vector&lt;KeyPair&gt;&gt; key_pairs =</font></div><div>        collectEmbedddedApexKeysFromDir(dir);</div></div></span></div></div></div></foreignObject><text x="482" y="771" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="360" y="582" width="120" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 589px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1663int onBootstrap() {</font></div><div><font color="#999999">1664  gBootstrap = true;</font></div><div><font color="#999999">1665</font></div><div><font color="#999999">1666  Status preAllocate = preAllocateLoopDevices();</font></div><div><font color="#999999">1667  if (!preAllocate.Ok()) {</font></div><div><font color="#999999">1668    LOG(ERROR) &lt;&lt; "Failed to pre-allocate loop devices : "</font></div><div><font color="#999999">1669               &lt;&lt; preAllocate.ErrorMessage();</font></div><div><font color="#999999">1670  }</font></div><div><font color="#999999">1671</font></div><div>1672  Status status = collectApexKeys();</div><div><br /></div></div></span></div></div></div></foreignObject><text x="362" y="601" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 300 585 L 300 614.5 Q 300 624.5 310 624.5 L 353.63 624.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="300" cy="582" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 358.88 624.5 L 351.88 628 L 353.63 624.5 L 351.88 621 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="362" width="120" height="220" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 369px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd_main.cpp</font><br /></div><div><div><font color="#999999">34int HandleSubcommand(char** argv) {</font></div><div><font color="#999999">35  if (strcmp("--pre-install", argv[1]) == 0) {</font></div><div><font color="#999999">36    LOG(INFO) &lt;&lt; "Preinstall subcommand detected";</font></div><div><font color="#999999">37    return android::apex::RunPreInstall(argv);</font></div><div><font color="#999999">38  }</font></div><div><font color="#999999">39</font></div><div><font color="#999999">40  if (strcmp("--post-install", argv[1]) == 0) {</font></div><div><font color="#999999">41    LOG(INFO) &lt;&lt; "Postinstall subcommand detected";</font></div><div><font color="#999999">42    return android::apex::RunPostInstall(argv);</font></div><div><font color="#999999">43  }</font></div><div><font color="#999999">44</font></div><div><font color="#999999">45  if (strcmp("--bootstrap", argv[1]) == 0) {</font></div><div><font color="#009900">46    LOG(INFO) &lt;&lt; "Bootstrap subcommand detected";</font></div><div>47    return android::apex::onBootstrap();</div></div></span></div></div></div></foreignObject><text x="242" y="381" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 180 365 L 180 407 Q 180 417 190 417 L 233.63 417" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="180" cy="362" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 238.88 417 L 231.88 420.5 L 233.63 417 L 231.88 413.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="120" y="252" width="120" height="110" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 259px; margin-left: 122px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd_main.cpp</font><br /></div><div><div><font color="#999999">69int main(int /*argc*/, char** argv) {</font></div><div><font color="#999999">70  // Use CombinedLogger to also log to the kernel log.</font></div><div><font color="#999999">71  android::base::InitLogging(argv, CombinedLogger());</font></div><div><font color="#999999">72</font></div><div><font color="#999999">73  if (argv[1] != nullptr) {</font></div><div>74    return HandleSubcommand(argv);</div></div></span></div></div></div></foreignObject><text x="122" y="271" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 60 135 L 60 269.5 Q 60 279.5 70 279.5 L 113.63 279.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="60" cy="132" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 118.88 279.5 L 111.88 283 L 113.63 279.5 L 111.88 276 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="32" width="120" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 39px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/core/rootdir/init.rc</font><br /></div><div><div><font color="#999999"><div>18on early-init</div></font></div><div><font color="#999999">35    # Run apexd-bootstrap so that APEXes that provide critical libraries</font></div><div><font color="#999999">36    # become available. Note that this is executed as exec_start to ensure that</font></div><div><font color="#999999">37    # the libraries are available to the processes started after this statement.</font></div><div>38    exec_start apexd-bootstrap</div></div></span></div></div></div></foreignObject><text x="2" y="51" fill="#000000" font-family="Helvetica" font-size="12px">/system/core/rootdir...</text></switch></g><rect x="80" y="132" width="310" height="110" rx="5.5" ry="5.5" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 139px; margin-left: 82px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.rc</font><br /></div><div><div>8service apexd-bootstrap /system/bin/apexd --bootstrap</div><div style="color: rgb(153 , 153 , 153)">9    critical</div><div style="color: rgb(153 , 153 , 153)">10    user root</div><div style="color: rgb(153 , 153 , 153)">11    group system</div><div style="color: rgb(153 , 153 , 153)">12    oneshot</div><div style="color: rgb(153 , 153 , 153)">13    disabled</div></div></span></div></div></div></foreignObject><text x="82" y="151" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/apexd.rc...</text></switch></g><path d="M 660 1005 L 660 1017 Q 660 1027 670 1027 L 713.63 1027" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="660" cy="1002" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 718.88 1027 L 711.88 1030.5 L 713.63 1027 L 711.88 1023.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="832" width="120" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 839px; margin-left: 602px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apex_key.cpp</font><br /></div><div><div><font color="#999999">40StatusOr&lt;std::vector&lt;KeyPair&gt;&gt; collectEmbedddedApexKeysFromDir(</font></div><div><font color="#999999">41    const std::string&amp; dir) {</font></div><div><font color="#009900">42  LOG(INFO) &lt;&lt; "Scanning " &lt;&lt; dir &lt;&lt; " for embedded keys";</font></div></div><div><div><font color="#999999">43  // list of &lt;key_name, key_content&gt; pairs</font></div><div style="color: rgb(153 , 153 , 153)">44  std::vector&lt;KeyPair&gt; ret;</div><div style="color: rgb(153 , 153 , 153)">45  if (access(dir.c_str(), F_OK) != 0 &amp;&amp; errno == ENOENT) {</div><div style="color: rgb(153 , 153 , 153)">46    LOG(INFO) &lt;&lt; "... does not exist. Skipping";</div><div style="color: rgb(153 , 153 , 153)">47    return StatusOr&lt;std::vector&lt;KeyPair&gt;&gt;(std::move(ret));</div><div style="color: rgb(153 , 153 , 153)">48  }</div><div>49  const bool scanBuiltinApexes = isPathForBuiltinApexes(dir);</div></div></span></div></div></div></foreignObject><text x="602" y="851" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 780 1075 L 780 1125.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="780" cy="1072" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 780 1130.88 L 776.5 1123.88 L 780 1125.63 L 783.5 1123.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="720" y="1012" width="120" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1019px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apex_file.cpp</font><br /></div><div><div><font color="#999999">507bool isPathForBuiltinApexes(const std::string&amp; path) {</font></div><div><font color="#999999">508  for (const auto&amp; dir : kApexPackageBuiltinDirs) {</font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><br /></div></div></span></div></div></div></foreignObject><text x="722" y="1031" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="855" y="1062" width="405" height="70" rx="3.5" ry="3.5" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1069px; margin-left: 857px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_constants.h</font><br /></div><div><div><font color="#999999">28static constexpr const char* kApexPackageSystemDir = </font><font color="#009900">"/system/apex"</font><font color="#999999">;</font></div><div><font color="#999999">29static const std::vector&lt;std::string&gt; kApexPackageBuiltinDirs = {</font></div><div><font color="#999999">30    kApexPackageSystemDir, </font><font color="#009900">"/product/apex"</font><font color="#999999">};</font></div></div></div></div></div></foreignObject><text x="857" y="1081" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/apex_constants.h...</text></switch></g><path d="M 717 1192 L 430 1192 Q 420 1192 420 1202 L 420 1215.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="720" cy="1192" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 1220.88 L 416.5 1213.88 L 420 1215.63 L 423.5 1213.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="720" y="1132" width="120" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1139px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#999999"><div>509    if (StartsWith(path, dir)) {</div><div>510      return true;</div><div>511    }</div><div>512  }</div><div>513  return false;</div></font></div></span></div></div></div></foreignObject><text x="722" y="1151" fill="#000000" font-family="Helvetica" font-size="12px">509    if (StartsWit...</text></switch></g><path d="M 420 1325 L 420 1347 Q 420 1357 430 1357 L 473.63 1357" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="1322" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 1357 L 471.88 1360.5 L 473.63 1357 L 471.88 1353.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="1222" width="120" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1229px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><span style="color: rgb(153 , 153 , 153)">1673  if (!status.Ok()) {</span><br /></div><div><div><font color="#990000">1674    LOG(ERROR) &lt;&lt; "Failed to collect APEX keys : " &lt;&lt; status.ErrorMessage();</font></div><div><font color="#999999">1675    return 1;</font></div><div><font color="#999999">1676  }</font></div></div><div><div style="color: rgb(153 , 153 , 153)">1678  // Activate built-in APEXes for processes launched before /data is mounted.</div><div>1679  status = scanPackagesDirAndActivate(kApexPackageSystemDir);</div></div></span></div></div></div></foreignObject><text x="362" y="1241" fill="#000000" font-family="Helvetica" font-size="12px">1673  if (!status.Ok...</text></switch></g><path d="M 540 1465 L 540 1594.5 Q 540 1604.5 550 1604.5 L 593.63 1604.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="540" cy="1462" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 598.88 1604.5 L 591.88 1608 L 593.63 1604.5 L 591.88 1601 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="1322" width="120" height="140" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1329px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1308Status scanPackagesDirAndActivate(const char* apex_package_dir) {</font></div><div><font color="#999999">1309  LOG(INFO) &lt;&lt; "Scanning " &lt;&lt; apex_package_dir &lt;&lt; " looking for APEX packages.";</font></div><div><div style="color: rgb(153 , 153 , 153)">1311  const bool scanBuiltinApexes = isPathForBuiltinApexes(apex_package_dir);</div><div style="color: rgb(153 , 153 , 153)">1312  StatusOr&lt;std::vector&lt;std::string&gt;&gt; scan =</div><div>1313      FindApexFilesByName(apex_package_dir, scanBuiltinApexes);</div></div><div>1324  <font color="#ff0000">for </font>(const std::string&amp; name : *scan) {<br /></div><div><font color="#999999">1325    LOG(INFO) &lt;&lt; "Found " &lt;&lt; name;</font></div><div><div>1353    Status res = activatePackageImpl(*apex_file);</div></div></div><div><br /></div></div></div></div></foreignObject><text x="482" y="1341" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="880" y="1402" width="100" height="40" rx="7.2" ry="7.2" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1409px; margin-left: 882px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#009900">"/system/apex"</font><br /></div><div><div><font color="#009900">"/product/apex"</font><br /></div></div></div></div></div></foreignObject><text x="882" y="1421" fill="#000000" font-family="Helvetica" font-size="12px">"/system/apex"...</text></switch></g><path d="M 660 2035 L 660 2043.5 Q 660 2052 670 2052 L 713.63 2052" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="660" cy="2032" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 718.88 2052 L 711.88 2055.5 L 713.63 2052 L 711.88 2048.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="1462" width="120" height="570" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 1469px; margin-left: 602px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1123Status activatePackageImpl(const ApexFile&amp; apex_file) {</font></div><div><font color="#999999">1124  const ApexManifest&amp; manifest = apex_file.GetManifest();</font></div><div><span style="color: rgb(153 , 153 , 153)">1134  // See whether we think it's active, and do not allow to activate the same</span><br /></div><div><font color="#999999">1135  // version. Also detect whether this is the highest version.</font></div><div><font color="#999999">1136  // We roll this into a single check.</font></div><div><font color="#999999">1137  bool </font>is_newest_version <font color="#999999">= true;</font></div><div><font color="#999999">1138  bool </font>found_other_version <font color="#999999">= false;</font></div><div><font color="#999999">1139  bool </font>version_found_mounted <font color="#999999">= false;</font></div><div><font color="#999999">1140  {</font></div><div><font color="#999999">1141    uint64_t new_version = manifest.version();</font></div><div><font color="#999999">1142    bool version_found_active = false;</font></div><div><font color="#999999">1143    gMountedApexes.ForallMountedApexes(</font></div><div><font color="#999999">1144        manifest.name(), [&amp;](const MountedApexData&amp; data, bool latest) {</font></div><div><font color="#999999">1145          StatusOr&lt;ApexFile&gt; otherApex = ApexFile::Open(data.full_path);</font></div><div><font color="#999999">1146          if (!otherApex.Ok()) {</font></div><div><font color="#999999">1147            return;</font></div><div><font color="#999999">1148          }</font></div><div><font color="#999999">1149          found_other_version = true;</font></div><div><font color="#999999">1150          if (static_cast&lt;uint64_t&gt;(otherApex-&gt;GetManifest().version()) ==</font></div><div><font color="#999999">1151              new_version) {</font></div><div><font color="#999999">1152            version_found_mounted = true;</font></div><div><font color="#999999">1153            version_found_active = latest;</font></div><div><font color="#999999">1154          }</font></div><div><font color="#999999">1155          if (static_cast&lt;uint64_t&gt;(otherApex-&gt;GetManifest().version()) &gt;</font></div><div><font color="#999999">1156              new_version) {</font></div><div><font color="#999999">1157            is_newest_version = false;</font></div><div><font color="#999999">1158          }</font></div><div><font color="#999999">1159        });</font></div><div><font color="#999999">1160    if (version_found_active) {</font></div><div><font color="#999999">1161      LOG(DEBUG) &lt;&lt; "Package " &lt;&lt; manifest.name() &lt;&lt; " with version "</font></div><div><font color="#999999">1162                 &lt;&lt; manifest.version() &lt;&lt; " already active";</font></div><div><font color="#999999">1163      return Status::Success();</font></div><div><font color="#999999">1164    }</font></div><div><font color="#999999">1165  }</font></div><div><font color="#999999">1166</font></div><div><font color="#999999">1167  const std::string&amp; mountPoint = apexd_private::GetPackageMountPoint(manifest);</font></div><div><font color="#999999">1168</font></div><div><font color="#999999">1169  if (!</font>version_found_mounted<font color="#999999">) {</font></div><div>1170    Status mountStatus = apexd_private::MountPackage(apex_file, mountPoint);<br /></div></div></div></div></div></foreignObject><text x="602" y="1481" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 780 2115 L 780 2147 Q 780 2157 790 2157 L 833.63 2157" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="780" cy="2112" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 838.88 2157 L 831.88 2160.5 L 833.63 2157 L 831.88 2153.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="720" y="2032" width="120" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2039px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><div><font color="#999999">1070Status MountPackage(const ApexFile&amp; apex, const std::string&amp; mountPoint) {</font></div><div><font color="#999999">1071  auto ret =</font></div><div>1072      MountPackageImpl(apex, mountPoint, GetPackageId(apex.GetManifest()),</div><div>1073                       /* verifyImage = */ false);</div></div></div></div></div></div></foreignObject><text x="722" y="2051" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 900 2295 L 900 2409.5 Q 900 2419.5 910 2419.5 L 953.63 2419.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="900" cy="2292" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 958.88 2419.5 L 951.88 2423 L 953.63 2419.5 L 951.88 2416 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="840" y="2112" width="120" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2119px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">525StatusOr&lt;MountedApexData&gt; MountPackageImpl(const ApexFile&amp; apex,</font></div><div><font color="#999999">526                                           const std::string&amp; mountPoint,</font></div><div><font color="#999999">527                                           const std::string&amp; device_name,</font></div><div><font color="#999999">528                                           bool verifyImage) {</font></div><div><font color="#999999">529  using StatusM = StatusOr&lt;MountedApexData&gt;;</font></div><div><font color="#999999">530  LOG(VERBOSE) &lt;&lt; "Creating mount point: " &lt;&lt; mountPoint;</font></div></div><div><div style="color: rgb(153 , 153 , 153)">557  StatusOr&lt;MountedApexData&gt; ret;</div><div>558  if (apex.IsFlattened()) {</div><div style="color: rgb(153 , 153 , 153)">559    ret = mountFlattened(apex, mountPoint);</div><div style="color: rgb(153 , 153 , 153)">560  } else {</div><div>561    ret = mountNonFlattened(apex, mountPoint, device_name, verifyImage);</div><div style="color: rgb(153 , 153 , 153)"><br /></div></div></div></div></div></foreignObject><text x="842" y="2131" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 1020 2805 L 1020 2813.5 Q 1020 2822 1010 2822 L 70 2822 Q 60 2822 60 2828.82 L 60 2835.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="1020" cy="2802" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 60 2840.88 L 56.5 2833.88 L 60 2835.63 L 63.5 2833.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="960" y="2292" width="120" height="510" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2299px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><div><font color="#999999">396StatusOr&lt;MountedApexData&gt; mountNonFlattened(const ApexFile&amp; apex,</font></div><div><font color="#999999">397                                            const std::string&amp; mountPoint,</font></div><div><font color="#999999">398                                            const std::string&amp; device_name,</font></div><div><font color="#999999">399                                            bool verifyImage) {</font></div></div></div><div><div style="color: rgb(153 , 153 , 153)"><span>409  loop::LoopbackDeviceUniqueFd loopbackDevice;</span><br /></div><div style="color: rgb(153 , 153 , 153)">410  for (size_t attempts = 1;; ++attempts) {</div><div>411    StatusOr&lt;loop::LoopbackDeviceUniqueFd&gt; ret = loop::createLoopDevice(</div><div>412        full_path, apex.GetImageOffset(), apex.GetImageSize());</div><div style="color: rgb(153 , 153 , 153)"><span>416    }</span><br /></div><div style="color: rgb(153 , 153 , 153)"><span>422  }</span><br /></div><div style="color: rgb(153 , 153 , 153)">423  LOG(VERBOSE) &lt;&lt; "Loopback device created: " &lt;&lt; loopbackDevice.name;</div><div style="color: rgb(153 , 153 , 153)">424</div><div style="color: rgb(153 , 153 , 153)"><span>431  std::string blockDevice = loopbackDevice.name;</span><br /></div><div>432  MountedApexData apex_data(loopbackDevice.name, apex.GetPath(), mountPoint,</div><div>433                            device_name);</div><div style="color: rgb(153 , 153 , 153)">434</div><div style="color: rgb(153 , 153 , 153)"><span>472  // TODO: consider moving this inside RunVerifyFnInsideTempMount.</span><br /></div><div style="color: rgb(153 , 153 , 153)">473  if (mountOnVerity &amp;&amp; verifyImage) {</div><div>474    Status verityStatus =</div><div>475        readVerityDevice(blockDevice, (*verityData).desc-&gt;image_size);</div><div style="color: rgb(153 , 153 , 153)">476    if (!verityStatus.Ok()) {</div><div style="color: rgb(153 , 153 , 153)">477      return StatusM::MakeError(verityStatus);</div><div style="color: rgb(153 , 153 , 153)">478    }</div><div style="color: rgb(153 , 153 , 153)">479  }</div><div style="color: rgb(153 , 153 , 153)">480</div><div><font color="#ff0000">481  if (mount(blockDevice.c_str(), mountPoint.c_str(), "ext4",</font></div><div><font color="#ff0000">482            MS_NOATIME | MS_NODEV | MS_DIRSYNC | MS_RDONLY, nullptr) == 0) {</font></div><div style="color: rgb(153 , 153 , 153)">483    LOG(INFO) &lt;&lt; "Successfully mounted package " &lt;&lt; full_path &lt;&lt; " on "</div><div style="color: rgb(153 , 153 , 153)">484              &lt;&lt; mountPoint;</div><div style="color: rgb(153 , 153 , 153)">485    auto status = VerifyMountedImage(apex, mountPoint);</div><div style="color: rgb(153 , 153 , 153)">486    if (!status.Ok()) {</div><div style="color: rgb(153 , 153 , 153)">487      umount2(mountPoint.c_str(), UMOUNT_NOFOLLOW | MNT_DETACH);</div><div style="color: rgb(153 , 153 , 153)">488      return StatusM::Fail(StringLog() &lt;&lt; "Failed to verify " &lt;&lt; full_path</div><div style="color: rgb(153 , 153 , 153)">489                                       &lt;&lt; ": " &lt;&lt; status.ErrorMessage());</div><div style="color: rgb(153 , 153 , 153)">490    }</div></div></div></div></div></foreignObject><text x="962" y="2311" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 60 2895 L 60 2907 Q 60 2917 70 2917 L 113.63 2917" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="60" cy="2892" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 118.88 2917 L 111.88 2920.5 L 113.63 2917 L 111.88 2913.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="0" y="2842" width="120" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2849px; margin-left: 2px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/core/rootdir/init.rc</font><br /></div><div><font color="#999999"><div>442on post-fs-data</div><div><span>476    start apexd</span><br /></div></font></div></span></div></div></div></foreignObject><text x="2" y="2861" fill="#000000" font-family="Helvetica" font-size="12px">/system/core/rootdir...</text></switch></g><path d="M 180 2965 L 180 2974.75 Q 180 2984.5 190 2984.5 L 233.63 2984.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="180" cy="2962" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 238.88 2984.5 L 231.88 2988 L 233.63 2984.5 L 231.88 2981 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="120" y="2902" width="120" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2909px; margin-left: 122px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd_main.cpp</font><br /></div><div><div><font color="#999999">69int main(int /*argc*/, char** argv) {</font></div><div><span>89  android::apex::onStart(vold_service);</span><br /></div></div><div><br /></div></span></div></div></div></foreignObject><text x="122" y="2921" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 180 6025 L 180 6037 Q 180 6047 190 6047 L 243.63 6047" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="180" cy="6022" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 248.88 6047 L 241.88 6050.5 L 243.63 6047 L 241.88 6043.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="120" y="6002" width="120" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 6009px; margin-left: 122px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><span style="color: rgb(153 , 153 , 153)">90  android::apex::binder::CreateAndRegisterService();</span><br /></div><div><br /></div></span></div></div></div></foreignObject><text x="122" y="6021" fill="#000000" font-family="Helvetica" font-size="12px">90  android::apex::b...</text></switch></g><rect x="120" y="6102" width="120" height="190" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 6109px; margin-left: 122px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><div style="color: rgb(153 , 153 , 153)">91  android::apex::binder::StartThreadPool();</div><div style="color: rgb(153 , 153 , 153)">92</div><div style="color: rgb(153 , 153 , 153)">93  // Notify other components (e.g. init) that all APEXs are correctly mounted</div><div style="color: rgb(153 , 153 , 153)">94  // and are ready to be used. Note that it's important that the binder service</div><div style="color: rgb(153 , 153 , 153)">95  // is registered at this point, since other system services might depend on</div><div style="color: rgb(153 , 153 , 153)">96  // it.</div><div style="color: rgb(153 , 153 , 153)">97  android::apex::onAllPackagesReady();</div><div style="color: rgb(153 , 153 , 153)">98</div><div style="color: rgb(153 , 153 , 153)">99  android::apex::waitForBootStatus(</div><div style="color: rgb(153 , 153 , 153)">100      android::apex::rollbackActiveSessionAndReboot,</div><div style="color: rgb(153 , 153 , 153)">101      android::apex::unmountDanglingMounts);</div><div style="color: rgb(153 , 153 , 153)">102</div><div>103  android::apex::binder::JoinThreadPool();</div></div></span></div></div></div></foreignObject><text x="122" y="6121" fill="#000000" font-family="Helvetica" font-size="12px">91  android::apex::b...</text></switch></g><path d="M 247 6077 L 190 6077 Q 180 6077 180 6086.32 L 180 6095.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="250" cy="6077" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 180 6100.88 L 176.5 6093.88 L 180 6095.63 L 183.5 6093.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="250" y="6032" width="120" height="60" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 6039px; margin-left: 252px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexservice.cpp</font><br /></div><div><div><font color="#999999">837static constexpr const char* </font>kApexServiceName <font color="#999999">= </font><font color="#009900">"apexservice"</font><font color="#999999">;</font></div><div><span style="color: rgb(153 , 153 , 153)">845void CreateAndRegisterService() {</span><br /></div><div><span style="color: rgb(153 , 153 , 153)">850  </span><font color="#ff0000">defaultServiceManager()-&gt;addService</font><span style="color: rgb(153 , 153 , 153)">(String16(</span>kApexServiceName<span style="color: rgb(153 , 153 , 153)">), apexService);</span><br /></div></div></div></div></div></foreignObject><text x="252" y="6051" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="240" y="2972" width="120" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 2979px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><div><font color="#999999">1689void onStart(CheckpointInterface* checkpoint_service) {</font></div><div><font color="#999999">1690  LOG(INFO) &lt;&lt; "Marking APEXd as starting";</font></div></div></div><div><font color="#999999"><div><br /></div><div><br /></div></font></div></span></div></div></div></foreignObject><text x="242" y="2991" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 420 3365 L 420 3374.75 Q 420 3384.5 430 3384.5 L 473.63 3384.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="3362" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 3384.5 L 471.88 3388 L 473.63 3384.5 L 471.88 3381 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="3252" width="120" height="110" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3259px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_database.cpp</font><br /></div><div><div><font color="#999999">256void MountedApexDatabase::PopulateFromMounts() {</font></div><div><font color="#999999">257  LOG(INFO) &lt;&lt; "Populating APEX database from mounts...";</font></div><div>262  std::ifstream mounts(<span><font color="#009900">"/proc/mounts"</font></span>);<br /></div><div><font color="#999999">263  std::string line;</font></div><div><font color="#999999">264  while (std::getline(mounts, line)) {</font></div><div><font color="#999999">265    auto [block, mountPoint] = </font>parseMountInfo<font color="#999999">(line);<br /></font></div></div><div><font color="#999999"><div><br /></div></font></div></div></div></div></foreignObject><text x="362" y="3271" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 477 3429.5 L 430 3429.5 Q 420 3429.5 420 3439.5 L 420 3455.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="3429.5" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 3460.88 L 416.5 3453.88 L 420 3455.63 L 423.5 3453.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="3362" width="120" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3369px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_database.cpp</font><br /></div><div><div><font color="#999999">125std::pair&lt;std::string, int&gt; parseMountPoint(const std::string&amp; mountPoint) {</font></div><div><font color="#999999">126  auto packageId = fs::path(mountPoint).filename();</font></div><div>127  auto split = Split(packageId, <font color="#009900">"@"</font>);</div><div><font color="#999999">128  if (split.size() == 2) {</font></div><div><span style="color: rgb(153 , 153 , 153)">133    return std::make_pair(split[0], version);</span><br /></div></div></div></div></div></foreignObject><text x="482" y="3381" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 420 3505 L 420 3527 Q 420 3537 430 3537 L 473.63 3537" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="3502" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 3537 L 471.88 3540.5 L 473.63 3537 L 471.88 3533.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="3462" width="120" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3469px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><span style="color: rgb(153 , 153 , 153)">281    auto [package, version] = parseMountPoint(mountPoint);</span><br /></div><div><div><font color="#999999">282    AddMountedApex(package, false, *mountData);</font></div></div></div></div></div></foreignObject><text x="362" y="3481" fill="#000000" font-family="Helvetica" font-size="12px">281    auto [package...</text></switch></g><path d="M 300 3695 L 300 3707 Q 300 3717 310 3717 L 353.63 3717" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="300" cy="3692" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 358.88 3717 L 351.88 3720.5 L 353.63 3717 L 351.88 3713.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="3642" width="120" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3649px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><span style="color: rgb(153 , 153 , 153)">1746  // Activate APEXes from /data/apex. If one in the directory is newer than the</span><br /></div><div><div><font color="#999999">1747  // system one, the new one will eclipse the old one.</font></div><div>1748  scanStagedSessionsDirAndStage();</div></div><div><div><br /></div></div></span></div></div></div></foreignObject><text x="242" y="3661" fill="#000000" font-family="Helvetica" font-size="12px">1746  // Activate AP...</text></switch></g><path d="M 300 3055 L 300 3069.5 Q 300 3079.5 310 3079.5 L 353.63 3079.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="300" cy="3052" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 358.88 3079.5 L 351.88 3083 L 353.63 3079.5 L 351.88 3076 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="3022" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3029px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><div><font color="#999999">1738  Status status = collectApexKeys();</font></div></div></span></div></div></div></foreignObject><text x="242" y="3041" fill="#000000" font-family="Helvetica" font-size="12px">1738  Status status...</text></switch></g><path d="M 420 3135 L 420 3143.5 Q 420 3152 430 3152 L 473.63 3152" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="3132" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 3152 L 471.88 3155.5 L 473.63 3152 L 471.88 3148.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="3062" width="120" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3069px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_key.cpp</font><br /></div><div><div><font color="#999999">92Status collectApexKeys(bool scanExternalKeys) {</font></div><div><font color="#999999">93  for (const auto&amp; dir : kApexPackageBuiltinDirs) {</font></div><div><span style="color: rgb(153 , 153 , 153)">100    Status st = updateScannedApexKeys(*key_pairs);</span><br /></div></div></div></div></div></foreignObject><text x="362" y="3081" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 477 3192 L 310 3192 Q 300 3192 300 3202 L 300 3215.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="3192" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 300 3220.88 L 296.5 3213.88 L 300 3215.63 L 303.5 3213.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="3132" width="120" height="80" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3139px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_key.cpp</font><br /></div><div><div><div><font color="#999999">74Status updateScannedApexKeys(const std::vector&lt;KeyPair&gt;&amp; key_pairs) {</font></div><div><font color="#999999">75  for (const KeyPair&amp; kp : key_pairs) {</font></div><div><font color="#999999">76    if (gScannedApexKeys.find(kp.first) == gScannedApexKeys.end()) {</font></div><div><font color="#999999">77      </font><span style="background-color: rgb(255 , 255 , 153)">gScannedApexKeys</span><font color="#999999">.insert({kp.first, kp.second});</font></div></div></div></div></div></div></foreignObject><text x="482" y="3151" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 300 3255 L 300 3269.5 Q 300 3279.5 310 3279.5 L 353.63 3279.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="300" cy="3252" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 358.88 3279.5 L 351.88 3283 L 353.63 3279.5 L 351.88 3276 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="3222" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3229px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div style="color: rgb(153 , 153 , 153)">1744  gMountedApexes.PopulateFromMounts();</div><div><br /></div></div></div></div></foreignObject><text x="242" y="3241" fill="#000000" font-family="Helvetica" font-size="12px">1744  gMountedApexes...</text></switch></g><path d="M 477 3607 L 310 3607 Q 300 3607 300 3617 L 300 3635.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="3607" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 300 3640.88 L 296.5 3633.88 L 300 3635.63 L 303.5 3633.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="3502" width="120" height="140" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3509px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_database.cpp</font><br /></div><div><div><div><font color="#999999">100  template &lt;typename... Args&gt;</font></div><div><font color="#999999">101  inline void AddMountedApex(const std::string&amp; package, bool latest,</font></div><div><font color="#999999">102                             Args&amp;&amp;... args) {</font></div><div><font color="#999999">103    auto it = mounted_apexes_.find(package);</font></div><div><font color="#999999">104    if (it == mounted_apexes_.end()) {</font></div><div><font color="#999999">105      auto insert_it =</font></div><div>106          <span style="background-color: rgb(255 , 255 , 153)">mounted_apexes_</span>.emplace(package, std::map&lt;MountedApexData, bool&gt;());</div><div><font color="#999999">107      CHECK(insert_it.second);</font></div></div></div></div></div></div></foreignObject><text x="482" y="3521" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="650" y="3062" width="100" height="40" rx="7.2" ry="7.2" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3069px; margin-left: 652px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#009900">"/system/apex"</font><br /></div><div><div><font color="#009900">"/product/apex"</font><br /></div></div></div></div></div></foreignObject><text x="652" y="3081" fill="#000000" font-family="Helvetica" font-size="12px">"/system/apex"...</text></switch></g><path d="M 420 3795 L 420 3811.5 Q 420 3821.5 430 3821.5 L 473.63 3821.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="3792" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 3821.5 L 471.88 3825 L 473.63 3821.5 L 471.88 3818 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="3692" width="120" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3699px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1374void scanStagedSessionsDirAndStage() {</font></div><div><font color="#999999">1375  LOG(INFO) &lt;&lt; "Scanning " &lt;&lt; kApexSessionsDir</font></div><div><font color="#999999">1376            &lt;&lt; " looking for sessions to be activated.";</font></div><div><font color="#999999">1377</font></div><div><font color="#999999">1378  auto stagedSessions = ApexSession::GetSessionsInState(SessionState::STAGED);</font></div><div><br /></div></div></span></div></div></div></foreignObject><text x="362" y="3711" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 540 3877 L 540 3916 Q 540 3926 550 3926 L 593.63 3926" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="540" cy="3874" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 598.88 3926 L 591.88 3929.5 L 593.63 3926 L 591.88 3922.5 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="3804" width="120" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3811px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd_session.cpp</font><br /></div><div><div><div><font color="#999999">141std::vector&lt;ApexSession&gt; ApexSession::GetSessionsInState(</font></div><div><font color="#999999">142    SessionState::State state) {</font></div><div><font color="#999999">143  auto sessions = GetSessions();</font></div></div></div></span></div></div></div></foreignObject><text x="482" y="3823" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 597 4030 L 430 4030 Q 420 4030 420 4040 L 420 4075.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="600" cy="4030" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 4080.88 L 416.5 4073.88 L 420 4075.63 L 423.5 4073.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="3874" width="120" height="208" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3881px; margin-left: 602px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd_session.cpp</font><br /></div><div><div><font color="#999999">115std::vector&lt;ApexSession&gt; ApexSession::GetSessions() {</font></div><div><font color="#999999">116  std::vector&lt;ApexSession&gt; sessions;</font></div><div><font color="#999999">117</font></div><div>118  StatusOr&lt;std::vector&lt;std::string&gt;&gt; sessionPaths = ReadDir(</div><div>119      <span style="background-color: rgb(255 , 255 , 153)">kApexSessionsDir</span>, [](const std::filesystem::directory_entry&amp; entry) {</div><div>120        std::error_code ec;</div><div>121        return entry.is_directory(ec);</div><div>122      });</div><div><span style="color: rgb(153 , 153 , 153)">127</span><br /></div><div><font color="#999999">128  for (const std::string&amp; sessionDirPath : *sessionPaths) {</font></div><div><font color="#999999">129    // Try to read session state</font></div><div>130    auto session = GetSessionFromFile(sessionDirPath + "/" + <span style="background-color: rgb(255 , 255 , 153)">kStateFileName</span>);</div><div><span style="color: rgb(153 , 153 , 153)">135    sessions.push_back(std::move(*session));</span><br /></div></div></div></div></div></foreignObject><text x="602" y="3893" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="1007.5" y="3932" width="262.5" height="60" rx="7.2" ry="7.2" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 3939px; margin-left: 1010px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd_session.h</font><br /></div><div></div><div><span>30static const std::string kApexSessionsDir =</span><br /></div><div><div>31    std::string(kApexDataDir) + <font color="#009900">"/sessions"</font>;</div></div></div></div></div></foreignObject><text x="1010" y="3951" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/apexd_session.h...</text></switch></g><rect x="950" y="4072" width="320" height="40" rx="4.8" ry="4.8" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4079px; margin-left: 952px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd_session.cpp</font><br /></div><div></div><div><div>40static constexpr const char* kStateFileName = <font color="#009900">"state"</font>;</div></div></div></div></div></foreignObject><text x="952" y="4091" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/apexd_session.cpp...</text></switch></g><path d="M 420 4155 L 420 4195.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="4152" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 4200.88 L 416.5 4193.88 L 420 4195.63 L 423.5 4193.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="4082" width="120" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4089px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><span style="color: rgb(153 , 153 , 153)">1392    std::vector&lt;std::string&gt; dirsToScan;</span><br /></div><div><div><font color="#999999">1393    if (session.GetChildSessionIds().empty()) {</font></div><div>1394      dirsToScan.push_back(std::string(<span style="background-color: rgb(255 , 255 , 153)">kStagedSessionsDir</span>) + "/session_" +</div><div><font color="#999999">1395                           std::to_string(sessionId));</font></div><div><br /></div></div></div></div></div></foreignObject><text x="362" y="4101" fill="#000000" font-family="Helvetica" font-size="12px">1392    std::vector&lt;...</text></switch></g><path d="M 420 4365 L 420 4379.5 Q 420 4389.5 430 4389.5 L 473.63 4389.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="4362" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 4389.5 L 471.88 4393 L 473.63 4389.5 L 471.88 4386 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="4202" width="120" height="160" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4209px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><font color="#999999"><div>1403    std::vector&lt;std::string&gt; apexes;</div><div>1404    bool scanSuccessful = true;</div><div>1405    for (const auto&amp; dirToScan : dirsToScan) {</div><div>1406      StatusOr&lt;std::vector&lt;std::string&gt;&gt; scan =</div><div>1407          FindApexFilesByName(dirToScan, /* include_dirs=*/false);</div><div><div>1408      if (!scan.Ok()) {</div><div><span>1414      if (scan-&gt;size() &gt; 1) {</span><br /></div><div><span>1421      if (scan-&gt;empty()) {</span><br /></div><div><span>1427      apexes.push_back(std::move((*scan)[0]));</span><br /></div></div><div><div>1434    // Run postinstall, if necessary.</div><div>1435    Status postinstall_status = postinstallPackages(apexes);</div><br /></div></font></span></div></div></div></foreignObject><text x="362" y="4221" fill="#000000" font-family="Helvetica" font-size="12px">1403    std::vector&lt;...</text></switch></g><rect x="480" y="4152" width="400" height="40" rx="4.8" ry="4.8" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4159px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apex_constants.h</font><br /></div><div><font color="#999999">32static constexpr const char* kStagedSessionsDir = </font><font color="#009900">"/data/app-staging"</font><font color="#999999">;</font></div></div></div></div></foreignObject><text x="482" y="4171" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/apex_constants.h...</text></switch></g><path d="M 540 4475 L 540 4489.5 Q 540 4499.5 550 4499.5 L 593.63 4499.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="540" cy="4472" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 598.88 4499.5 L 591.88 4503 L 593.63 4499.5 L 591.88 4496 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="4362" width="120" height="110" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4369px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1469Status postinstallPackages(const std::vector&lt;std::string&gt;&amp; paths) {</font></div><div><font color="#999999">1470  if (paths.empty()) {</font></div><div><font color="#999999">1471    return Status::Fail("Empty set of inputs");</font></div><div><font color="#999999">1472  }</font></div><div><font color="#999999">1473  LOG(DEBUG) &lt;&lt; "postinstallPackages() for " &lt;&lt; Join(paths, ',');</font></div><div><font color="#999999">1474  return HandlePackages&lt;Status&gt;(paths, PostinstallPackages);</font></div></div></span></div></div></div></foreignObject><text x="482" y="4381" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 660 4555 L 660 4599.5 Q 660 4609.5 670 4609.5 L 713.63 4609.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="660" cy="4552" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 718.88 4609.5 L 711.88 4613 L 713.63 4609.5 L 711.88 4606 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="600" y="4482" width="120" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4489px; margin-left: 602px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">677Status PostinstallPackages(const std::vector&lt;ApexFile&gt;&amp; apexes) {</font></div><div><font color="#999999">678  return PrePostinstallPackages(apexes, &amp;ApexManifest::postinstallhook,</font></div><div><font color="#999999">679                                &amp;StagePostInstall);</font></div></div></span></div></div></div></foreignObject><text x="602" y="4501" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 717 4724.5 L 430 4724.5 Q 420 4724.5 420 4734.5 L 420 4775.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="720" cy="4724.5" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 4780.88 L 416.5 4773.88 L 420 4775.63 L 423.5 4773.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="720" y="4552" width="120" height="230" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4559px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">645template &lt;typename HookFn, typename HookCall&gt;</font></div><div><font color="#999999">646Status PrePostinstallPackages(const std::vector&lt;ApexFile&gt;&amp; apexes, HookFn fn,</font></div><div><font color="#999999">647                              HookCall call) {</font></div><div><span>652  // 1) Check whether the APEXes have hooks.</span><br /></div><div><font color="#999999">653  bool has_hooks = false;</font></div><div><font color="#999999">654  for (const ApexFile&amp; apex_file : apexes) {</font></div><div><font color="#999999">655    if (!(apex_file.GetManifest().*fn)().empty()) {</font></div><div><font color="#999999">656      has_hooks = true;</font></div><div><font color="#999999">657      break;</font></div><div><font color="#999999">658    }</font></div><div><font color="#999999">659  }</font></div><div><font color="#999999">660</font></div><div>661  // 2) If we found hooks, run the pre/post-install.</div><div><font color="#999999">662  if (has_hooks) {</font></div><div><font color="#999999">663    Status install_status = (*call)(apexes);</font></div></div></span></div></div></div></foreignObject><text x="722" y="4571" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 420 4815 L 420 4934.5 Q 420 4944.5 430 4944.5 L 473.63 4944.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="4812" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 4944.5 L 471.88 4948 L 473.63 4944.5 L 471.88 4941 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="4782" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4789px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><font color="#999999"><div><div>1443    const Status result = stagePackages(apexes);</div></div><div><br /></div></font></span></div></div></div></foreignObject><text x="362" y="4801" fill="#000000" font-family="Helvetica" font-size="12px">1443    const Status...</text></switch></g><path d="M 477 5209.5 L 430 5209.5 Q 420 5209.5 420 5219.5 L 420 5335.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="5209.5" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 420 5340.88 L 416.5 5333.88 L 420 5335.63 L 423.5 5333.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="4812" width="120" height="530" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 4819px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1518Status stagePackages(const std::vector&lt;std::string&gt;&amp; tmpPaths) {</font></div><div><span>1527  // 1) Verify all packages.</span><br /></div><div><font color="#999999">1528  auto verify_status = verifyPackages(tmpPaths, VerifyPackageBoot);</font></div><div><font color="#999999">1529  if (!verify_status.Ok()) {</font></div><div><font color="#999999">1530    return Status::Fail(verify_status.ErrorMessage());</font></div><div><font color="#999999">1531  }</font></div><div><font color="#999999">1532</font></div><div>1533  // 2) Now stage all of them.</div><div><span style="color: rgb(153 , 153 , 153)">1541</span><br /></div><div>1542  // 2) Filter out packages that do not require staging, e.g.:</div><div>1543  //    a) Their /data/apex/active/package.apex@version already exists.</div><div>1544  //    b) Such package is already active</div><div><font color="#999999">1545  std::vector&lt;std::string&gt; paths_to_stage =</font></div><div><font color="#999999">1546      FilterUnnecessaryStagingPaths(tmpPaths);</font></div><div><span style="color: rgb(153 , 153 , 153)">1552</span><br /></div><div>1553  // 3) Now stage all of them.</div><div><span style="color: rgb(153 , 153 , 153)">1565</span><br /></div><div><font color="#999999">1566  std::unordered_set&lt;std::string&gt; staged_packages;</font></div><div><font color="#999999">1567  for (const std::string&amp; path : paths_to_stage) {</font></div><div><font color="#999999">1568    StatusOr&lt;ApexFile&gt; apex_file = ApexFile::Open(path);</font></div><div><font color="#999999">1569    if (!apex_file.Ok()) {</font></div><div><font color="#999999">1570      return apex_file.ErrorStatus();</font></div><div><font color="#999999">1571    }</font></div><div><font color="#999999">1572    std::string dest_path = StageDestPath(*apex_file);</font></div><div><font color="#999999">1573</font></div><div><font color="#ff0000">1574    if (link(apex_file-&gt;GetPath().c_str(), dest_path.c_str()) != 0) {</font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999"><br /></font></div><div><font color="#999999">1575      // TODO: Get correct binder error status.</font></div><div><font color="#999999">1576      return Status::Fail(PStringLog()</font></div><div><font color="#999999">1577                          &lt;&lt; "Unable to link " &lt;&lt; apex_file-&gt;GetPath() &lt;&lt; " to "</font></div><div><font color="#999999">1578                          &lt;&lt; dest_path);</font></div><div><font color="#999999">1579    }</font></div><div>1580    staged_files.insert(dest_path);</div><div>1581    staged_packages.insert(apex_file-&gt;GetManifest().name());</div></div></span></div></div></div></foreignObject><text x="482" y="4831" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><rect x="530" y="5202" width="645" height="30" rx="3.6" ry="3.6" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5209px; margin-left: 532px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">link /data/app-staging/session_591892586/base.apex /data/apex/active/com.blackshark.exlight_apex@290000002.apex</div></div></div></foreignObject><text x="532" y="5221" fill="#000000" font-family="Helvetica" font-size="12px">link /data/app-staging/session_591892586/base.apex /data/apex/active/com.blackshark.exlight_apex@290000002....</text></switch></g><path d="M 420 5375 L 420 5399.5 Q 420 5409.5 430 5409.5 L 473.63 5409.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="5372" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 5409.5 L 471.88 5413 L 473.63 5409.5 L 471.88 5406 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="5342" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5349px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><font color="#999999"><div><div><div>1453    auto st = session.UpdateStateAndCommit(SessionState::ACTIVATED);</div></div></div><div><br /></div></font></span></div></div></div></foreignObject><text x="362" y="5361" fill="#000000" font-family="Helvetica" font-size="12px">1453    auto st = se...</text></switch></g><path d="M 477 5484.5 L 310 5484.5 Q 300 5484.5 300 5494.5 L 300 5555.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="5484.5" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 300 5560.88 L 296.5 5553.88 L 300 5555.63 L 303.5 5553.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="5372" width="120" height="150" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5379px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd_session.cpp</font><br /></div><div><div><div><font color="#999999">197Status ApexSession::UpdateStateAndCommit(</font></div><div><font color="#999999">198    const SessionState::State&amp; session_state) {</font></div><div><font color="#999999">199  state_.set_state(session_state);</font></div><div><font color="#999999">200</font></div><div><font color="#999999">201  auto stateFilePath = getSessionStateFilePath(state_.id());</font></div><div><font color="#999999">202</font></div><div>203  std::fstream stateFile(stateFilePath,</div><div>204                         std::ios::out | std::ios::trunc | std::ios::binary);</div><div>205  if (!state_.SerializeToOstream(&amp;stateFile)) {</div></div></div></div></div></div></foreignObject><text x="482" y="5391" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 300 5595 L 300 5604.75 Q 300 5614.5 310 5614.5 L 353.63 5614.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="300" cy="5592" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 358.88 5614.5 L 351.88 5618 L 353.63 5614.5 L 351.88 5611 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="5562" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5569px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div>1754  status = scanPackagesDirAndActivate(kActiveApexPackagesDataDir);</div><div style="color: rgb(153 , 153 , 153)"><br /></div></div></div></div></foreignObject><text x="242" y="5581" fill="#000000" font-family="Helvetica" font-size="12px">1754  status = scanP...</text></switch></g><path d="M 237 5967 L 190 5967 Q 180 5967 180 5977 L 180 5995.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="240" cy="5967" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 180 6000.88 L 176.5 5993.88 L 180 5995.63 L 183.5 5993.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="5932" width="120" height="70" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5939px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><span><font color="#999999"><div><div>1755  if (!status.Ok()) {</div><div>1756    LOG(ERROR) &lt;&lt; "Failed to activate packages from "</div><div>1757               &lt;&lt; kActiveApexPackagesDataDir &lt;&lt; " : " &lt;&lt; status.ErrorMessage();</div><div>1758    Status rollback_status = rollbackActiveSessionAndReboot();</div></div></font></span></div></div></div></foreignObject><text x="242" y="5951" fill="#000000" font-family="Helvetica" font-size="12px">1755  if (!status.Ok...</text></switch></g><path d="M 420 5685 L 420 5734.5 Q 420 5744.5 430 5744.5 L 473.63 5744.5" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="420" cy="5682" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 478.88 5744.5 L 471.88 5748 L 473.63 5744.5 L 471.88 5741 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="5592" width="120" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5599px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd.cpp</font><br /></div><div><div><font color="#999999">1123Status activatePackageImpl(const ApexFile&amp; apex_file) {</font></div></div><div><div style="color: rgb(153 , 153 , 153)">1176  bool mounted_latest = false;</div><div style="color: rgb(153 , 153 , 153)">1177  if (is_newest_version) {</div><div>1178    const Status&amp; update_st = apexd_private::BindMount(</div><div>1179        apexd_private::GetActiveMountPoint(manifest), mountPoint);</div></div><div><br /></div></div></div></div></foreignObject><text x="362" y="5611" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><path d="M 477 5869.5 L 310 5869.5 Q 300 5869.5 300 5879.5 L 300 5925.63" fill="none" stroke="#9673a6" stroke-miterlimit="10" pointer-events="stroke"/><ellipse cx="480" cy="5869.5" rx="3" ry="3" fill="#9673a6" stroke="#9673a6" pointer-events="all"/><path d="M 300 5930.88 L 296.5 5923.88 L 300 5925.63 L 303.5 5923.88 Z" fill="#9673a6" stroke="#9673a6" stroke-miterlimit="10" pointer-events="all"/><rect x="480" y="5682" width="120" height="250" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 5689px; margin-left: 482px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><div><font color="#ffb570">/system/apex/apexd/apexd_private.cpp</font><br /></div><div><div><font color="#999999">33Status BindMount(const std::string&amp; target, const std::string&amp; source) {</font></div><div><font color="#999999">34  LOG(VERBOSE) &lt;&lt; "Creating bind-mount for " &lt;&lt; target &lt;&lt; " for " &lt;&lt; source;</font></div><div><span style="color: rgb(153 , 153 , 153)">74    // Unmount any active bind-mount.</span><br /></div><div><font color="#999999">75    if (exists) {</font></div><div><font color="#ff0000">76      int rc = umount2(target.c_str(), UMOUNT_NOFOLLOW | MNT_DETACH);</font></div><div><font color="#999999">77      if (rc != 0 &amp;&amp; errno != EINVAL) {</font></div><div><font color="#999999">78        // Log error but ignore.</font></div><div><font color="#999999">79        PLOG(ERROR) &lt;&lt; "Could not unmount " &lt;&lt; target;</font></div><div><font color="#999999">80      }</font></div><div><font color="#999999">81    }</font></div><div><font color="#999999">82  }</font></div><div><font color="#999999">83</font></div><div><font color="#999999">84  LOG(VERBOSE) &lt;&lt; "Bind-mounting " &lt;&lt; source &lt;&lt; " to " &lt;&lt; target;</font></div><div><font color="#ff0000">85  if (mount(source.c_str(), target.c_str(), nullptr, MS_BIND, nullptr) == 0) {</font></div><div><font color="#999999">86    return Status::Success();</font></div><div><font color="#999999">87  }<br /></font></div></div></div></div></div></foreignObject><text x="482" y="5701" fill="#000000" font-family="Helvetica" font-size="12px">/system/apex/apexd/a...</text></switch></g><ellipse cx="445" cy="4867" rx="15" ry="15" fill="#007fff" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 4867px; margin-left: 431px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">7.1</div></div></div></foreignObject><text x="445" y="4871" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">7.1</text></switch></g><ellipse cx="870" cy="2417" rx="15" ry="15" fill="#007fff" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2417px; margin-left: 856px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">7.2</div></div></div></foreignObject><text x="870" y="2421" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">7.2</text></switch></g><ellipse cx="870" cy="2507" rx="15" ry="15" fill="#007fff" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2507px; margin-left: 856px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">7.3</div></div></div></foreignObject><text x="870" y="2511" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">7.3</text></switch></g><ellipse cx="870" cy="2677" rx="15" ry="15" fill="#007fff" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2677px; margin-left: 856px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">7.4</div></div></div></foreignObject><text x="870" y="2681" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">7.4</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>