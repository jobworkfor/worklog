<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="7509px" height="3213px" viewBox="-0.5 -0.5 7509 3213" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-11-01T03:54:27.006Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot; etag=&quot;yt7UKdUvrSktsKfEkQ5g&quot; version=&quot;20.5.1&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;3DulHgM3GVHq9iDLcP9_&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="2827" y="4" width="600" height="460" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 597px; height: 1px; padding-top: 4px; margin-left: 2832px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style="color: rgb(51, 51, 51); font-size: 8.3pt;"><font face="consolas"><font color="#000000">【说明信息】DisplayEventReceiver::Event 对象 VSync 相关定义如下：<br /></font><span style="color: rgb(140, 140, 140); font-style: italic;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\include\gui\DisplayEventReceiver.h<br /></span><span style="color: rgb(0, 51, 179);">class </span><span style="color: rgb(0, 128, 128);">DisplayEventReceiver </span><font style="color: rgb(8, 8, 8);">{<br /></font><span style="color: rgb(0, 51, 179);">public</span><font style="color: rgb(8, 8, 8);">:<br />    </font><font color="#0033b3" style="">...</font><font color="#080808" style=""><br />    </font><span style="color: rgb(0, 51, 179);">struct </span><span style="color: rgb(0, 128, 128);">Event </span><font color="#080808" style="">{<br />        </font><font color="#8c8c8c" style=""><i>...</i></font><span style="color: rgb(140, 140, 140); font-style: italic;"><br /></span><span style="color: rgb(140, 140, 140); font-style: italic;">        </span><span style="color: rgb(0, 51, 179);">struct </span><span style="color: rgb(0, 128, 128);">Header </span><font color="#080808" style="">{<br />            </font><span style="color: rgb(55, 31, 128);">uint32_t </span><span style="color: rgb(102, 14, 122);">type</span><font color="#080808" style="">;<br />            PhysicalDisplayId </font><span style="color: rgb(102, 14, 122);">displayId </span><span style="color: rgb(0, 51, 179);">__attribute__</span><font color="#080808" style="">((aligned(</font><span style="color: rgb(23, 80, 235);">8</span><font color="#080808" style="">)));<br />            </font><span style="color: rgb(55, 31, 128);">nsecs_t </span><span style="color: rgb(102, 14, 122);">timestamp </span><span style="color: rgb(0, 51, 179);">__attribute__</span><font color="#080808" style="">((aligned(</font><span style="color: rgb(23, 80, 235);">8</span><font color="#080808" style="">)));<br />        };<br /><br />        </font><span style="color: rgb(0, 51, 179);">struct </span><span style="color: rgb(0, 128, 128);">VSync </span><font color="#080808" style="">{<br />            </font><span style="color: rgb(55, 31, 128);">uint32_t </span><span style="color: rgb(102, 14, 122);">count</span><font color="#080808" style="">;<br />            </font><span style="color: rgb(55, 31, 128);">nsecs_t </span><span style="color: rgb(102, 14, 122);">expectedVSyncTimestamp </span><span style="color: rgb(0, 51, 179);">__attribute__</span><font color="#080808" style="">((aligned(</font><span style="color: rgb(23, 80, 235);">8</span><font color="#080808" style="">)));<br />            </font><span style="color: rgb(55, 31, 128);">nsecs_t </span><span style="color: rgb(102, 14, 122);">deadlineTimestamp </span><span style="color: rgb(0, 51, 179);">__attribute__</span><font color="#080808" style="">((aligned(</font><span style="color: rgb(23, 80, 235);">8</span><font color="#080808" style="">)));<br />            </font><span style="color: rgb(55, 31, 128);">nsecs_t </span><span style="color: rgb(102, 14, 122);">frameInterval </span><span style="color: rgb(0, 51, 179);">__attribute__</span><font color="#080808" style="">((aligned(</font><span style="color: rgb(23, 80, 235);">8</span><font color="#080808" style="">)));<br />            </font><span style="color: rgb(55, 31, 128);">int64_t </span><span style="color: rgb(102, 14, 122);">vsyncId</span><font color="#080808" style="">;<br />        };<br />        </font><font color="#0033b3" style="">...</font><font color="#080808" style=""><br />        </font><span style="color: rgb(0, 128, 128);">Header </span><span style="color: rgb(102, 14, 122);">header</span><font style="color: rgb(8, 8, 8);">;<br /></font><font color="#999999">        // VSync 事件与其他事件定义为联合体类型<br /></font><font style="color: rgb(8, 8, 8);">        </font><span style="color: rgb(0, 51, 179);">union </span><font color="#080808" style="">{<br />            </font><span style="color: rgb(0, 128, 128);">VSync </span><span style="color: rgb(102, 14, 122);">vsync</span><font color="#080808" style="">;<br />            </font><span style="color: rgb(0, 128, 128);">Hotplug </span><span style="color: rgb(102, 14, 122);">hotplug</span><font color="#080808" style="">;<br />            </font><span style="color: rgb(0, 128, 128);">ModeChange </span><span style="color: rgb(102, 14, 122);">modeChange</span><font color="#080808" style="">;<br />            </font><span style="color: rgb(0, 128, 128);">FrameRateOverride </span><span style="color: rgb(102, 14, 122);">frameRateOverride</span><font color="#080808" style="">;<br />        };<br />    };</font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2832" y="16" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">【说明信息】DisplayEventReceiver::Event 对象 VSync 相关定义如下：...</text></switch></g><rect x="4187" y="1324" width="680" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 682px; height: 1px; padding-top: 1334px; margin-left: 4187px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】surfaceflinger@app：唤醒 surfaceflinger@app 线程中的 wait()</div></div></div></foreignObject><text x="4187" y="1338" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】surfaceflinger@app：唤醒 surfaceflinger@app 线程中的 wait()</text></switch></g><rect x="27" y="1004" width="600" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 602px; height: 1px; padding-top: 1014px; margin-left: 27px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】com.blackshark.mola@main：请求 VSync 的 APP 进程</div></div></div></foreignObject><text x="27" y="1018" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】com.blackshark.mola@main：请求 VSync 的 APP 进程</text></switch></g><rect x="27" y="1024" width="600" height="240" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 597px; height: 1px; padding-top: 1024px; margin-left: 32px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// at android.view.DisplayEventReceiver.scheduleVsync(DisplayEventReceiver.java:252)<br /></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">/**<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;"> * Schedules a single vertical sync pulse to be delivered when the next<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;"> * display frame begins.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;"> */<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 0);">@UnsupportedAppUsage<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public void </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">scheduleVsync() {<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mReceiverPtr </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 255);">0</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        Log.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">w</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TAG</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"Attempted to schedule a vertical sync pulse but the display event "<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">                </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"receiver has already been disposed."</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    } </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">else </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt;">{<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // 向 SF 请求 VSync，<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt;">        </span><span style="font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic; background-color: rgb(204, 204, 204);">nativeScheduleVsync</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mReceiverPtr</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    }<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="32" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// at android.view.DisplayEventReceiver.scheduleVsync(DisplayEventReceiver.java:252)...</text></switch></g><rect x="667" y="1024" width="660" height="210" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 657px; height: 1px; padding-top: 1024px; margin-left: 672px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">nativeScheduleVsync</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">(JNIEnv* env, jclass clazz, jlong receiverPtr) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // 在 nativeInit 时，java 层保存了 NativeDisplayEventReceiver 的指针，这里将其<br />    // 强转为 NativeDisplayEventReceiver 对象，并调用其 scheduleVsync() 方法<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">NativeDisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">receiver </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">=<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">reinterpret_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;NativeDisplayEventReceiver*&gt;(receiverPtr);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">receiver</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">scheduleVsync</span><span style="background-color: rgb(255, 255, 255);">();<br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">String8 </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">message</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">message</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.appendFormat(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to schedule next vertical sync pulse.  status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        jniThrowRuntimeException(env, message.string());<br />    }<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="672" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp...</text></switch></g><path d="M 207 1219 Q 237 1219 437 1121.5 Q 637 1024 660.63 1024" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 665.88 1024 L 658.88 1027.5 L 660.63 1024 L 658.88 1020.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="202" cy="1219" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="1387" y="1024" width="680" height="420" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 1024px; margin-left: 1392px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">scheduleVsync</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">() {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // mWaitingForVsync 用于避免处理高频调用，当正在处理 VSync 请求时，丢弃后续请求<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mWaitingForVsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ Scheduling vsync."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Drain all pending events.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">nsecs_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncTimestamp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        PhysicalDisplayId vsyncDisplayId;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncCount</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncEventData </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncEventData</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // 查看缓存中是否还有 VSync 事件，如果有说明还有没被消化的 VSync，会打印一句错误 log<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">(</span><span style="background-color: rgb(204, 204, 204);">processPendingEvents</span><span style="background-color: rgb(255, 255, 255);">(&amp;vsyncTimestamp, &amp;vsyncDisplayId, &amp;vsyncCount, &amp;vsyncEventData)) {<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ last event processed while scheduling was for %" </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">PRId64 </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">""</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />                  ns2ms(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">nsecs_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncTimestamp</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">)));<br />        }<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // 不管 processPendingEvents() 返回 true 还是 false 都会继续请求 Vsync<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= mReceiver.</span><span style="background-color: rgb(204, 204, 204);">requestNextVsync</span><span style="background-color: rgb(255, 255, 255);">();<br />        </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to request next vsync, status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">status</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mWaitingForVsync </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">true</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">OK</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1392" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp...</text></switch></g><path d="M 967 1129 Q 997 1129 1177 1076.5 Q 1357 1024 1380.63 1024" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1385.88 1024 L 1378.88 1027.5 L 1380.63 1024 L 1378.88 1020.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="962" cy="1129" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2107" y="4" width="680" height="950" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 4px; margin-left: 2112px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">bool </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">processPendingEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">nsecs_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outTimestamp,<br />                                                  PhysicalDisplayId* outDisplayId,<br />                                                  </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outCount,<br />                                                  </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncEventData</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outVsyncEventData) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">bool </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">gotVsync </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">false</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // EVENT_BUFFER_SIZE = 100<br />    // 从DisplayEventDispatcher管道一次读取的事件数量。<br />    // 该值应该足够大，以便我们可以使用几次较大的读取来快速清空管道。<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">buf</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">[</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">EVENT_BUFFER_SIZE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">];<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">while </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">((n = mReceiver.</span><span style="background-color: rgb(204, 204, 204);">getEvents</span><span style="background-color: rgb(255, 255, 255);">(buf, EVENT_BUFFER_SIZE)) &gt; </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ Read %d events."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">(n));<br />        mFrameRateOverrides.reserve(n);<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // 遍历缓存事件数组 buf[]，分别处理 6 种类型的事件。在 DisplayEventReceiver.h 中定义。<br />        // DISPLAY_EVENT_VSYNC = fourcc('v', 's', 'y', 'n'),<br />        // DISPLAY_EVENT_HOTPLUG = fourcc('p', 'l', 'u', 'g'),<br />        // DISPLAY_EVENT_MODE_CHANGE = fourcc('m', 'o', 'd', 'e'),<br />        // DISPLAY_EVENT_NULL = fourcc('n', 'u', 'l', 'l'),<br />        // DISPLAY_EVENT_FRAME_RATE_OVERRIDE = fourcc('r', 'a', 't', 'e'),<br />        // DISPLAY_EVENT_FRAME_RATE_OVERRIDE_FLUSH = fourcc('f', 'l', 's', 'h'),<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">for </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ssize_t i = </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; i &lt; n; i++) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 242, 204);">DisplayEventReceiver::Event</span><span style="background-color: rgb(255, 255, 255);">&amp; ev = buf[i];<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">switch </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ev.header.type) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_VSYNC:<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Later vsync events will just overwrite the info from earlier<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;"><i style="font-family: Consolas, monospace; color: rgb(140, 140, 140);">                    // ones. That's fine, we only care about the most recent.<br /></i><font color="#ff3333" style="" face="consolas"><i style="">                    // 后来的 VSync 将覆盖之前的 VSync，这里只关心缓存中最新的 VSync 信号<br /></i></font></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">                    </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">gotVsync = </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">true</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                    *outTimestamp = ev.header.timestamp;<br />                    *outDisplayId = ev.header.displayId;<br />                    *outCount = ev.vsync.count;<br />                    outVsyncEventData-&gt;id = ev.vsync.vsyncId;<br />                    outVsyncEventData-&gt;deadlineTimestamp = ev.vsync.deadlineTimestamp;<br />                    outVsyncEventData-&gt;frameInterval = ev.vsync.frameInterval;<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_HOTPLUG:<br />                    dispatchHotplug(ev.header.timestamp, ev.header.displayId, ev.hotplug.connected);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_MODE_CHANGE:<br />                    dispatchModeChanged(ev.header.timestamp, ev.header.displayId,<br />                                        ev.modeChange.modeId, ev.modeChange.vsyncPeriod);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_NULL:<br />                    dispatchNullEvent(ev.header.timestamp, ev.header.displayId);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_FRAME_RATE_OVERRIDE:<br />                    mFrameRateOverrides.emplace_back(ev.frameRateOverride);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_FRAME_RATE_OVERRIDE_FLUSH:<br />                    dispatchFrameRateOverrides(ev.header.timestamp, ev.header.displayId,<br />                                               std::move(mFrameRateOverrides));<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">default</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">:<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ ignoring unknown event type %#x"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, ev.header.type);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />            }<br />        }<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to get events from display event dispatcher, status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">));<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">gotVsync</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br />}</span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;"><br /></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2112" y="16" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp...</text></switch></g><path d="M 1597 1219 Q 1627 1219 1852 611.5 Q 2077 4 2100.63 4" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2105.88 4 L 2098.88 7.5 L 2100.63 4 L 2098.88 0.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="1592" cy="1219" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><path d="M 2927 99 Q 2897 99 2632 219 Q 2367 339 2343.37 339" fill="none" stroke="#d6b656" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2338.12 339 L 2345.12 335.5 L 2343.37 339 L 2345.12 342.5 Z" fill="#d6b656" stroke="#d6b656" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2932" cy="99" rx="5" ry="5" fill="#d6b656" stroke="none" pointer-events="all"/><ellipse cx="2332" cy="339" rx="5" ry="5" fill="#d6b656" stroke="none" pointer-events="all"/><rect x="2107" y="1024" width="530" height="140" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 527px; height: 1px; padding-top: 1024px; margin-left: 2112px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">requestNextVsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">() {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventConnection </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">!= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">nullptr</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventConnection</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">requestNextVsync</span><span style="background-color: rgb(255, 255, 255);">();<br />        </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">NO_INIT</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />}</span></font></pre></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2112" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp...</text></switch></g><path d="M 1732 1289 Q 1762 1289 1919.5 1156.5 Q 2077 1024 2100.63 1024" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2105.88 1024 L 2098.88 1027.5 L 2100.63 1024 L 2098.88 1020.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="1727" cy="1289" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2707" y="1004" width="640" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 642px; height: 1px; padding-top: 1014px; margin-left: 2707px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】surfaceflinger@???：IPC from APP 进程</div></div></div></foreignObject><text x="2707" y="1018" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】surfaceflinger@???：IPC from APP 进程</text></switch></g><path d="M 2387 1079 Q 2417 1079 2547 1051.5 Q 2677 1024 2700.63 1024" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2705.88 1024 L 2698.88 1027.5 L 2700.63 1024 L 2698.88 1020.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1064px; margin-left: 2507px;"><div data-drawio-colors="color: #CCCCCC; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Consolas; color: rgb(204, 204, 204); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff3333" style="background-color: rgb(255, 255, 0);">IPC 调用</font></div></div></div></foreignObject><text x="2507" y="1067" fill="#CCCCCC" font-family="Consolas" font-size="11px" text-anchor="middle">IPC 调用</text></switch></g><ellipse cx="2382" cy="1079" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="2707" y="1024" width="640" height="100" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 1024px; margin-left: 2712px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">requestNextVsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">() {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ATRACE_NAME</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"requestNextVsync"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mEventThread</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">-&gt;</span><span style="background-color: rgb(204, 204, 204);">requestNextVsync</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />}</span></font></pre></pre></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2712" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><rect x="3387" y="1024" width="690" height="360" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 687px; height: 1px; padding-top: 1024px; margin-left: 3392px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThread</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">requestNextVsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">sp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">&gt;&amp; connection) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // connection-&gt;resyncCallback = Scheduler::[&amp;] { resync(); }<br />    // 当 connection-&gt;resyncCallback 不为空时，调用 resyncCallback() 函数即调用 Scheduler::resync() 方法<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">resyncCallback</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(204, 204, 204);">resyncCallback</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">()</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">std</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">lock_guard</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">std</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">mutex</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">lock</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mMutex</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">);<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // APP 接收 VSync 需要主动请求，请求一次，接收一次；底层的 VSync 则周期性发送，通常为 16.6ms 一次，<br />    // 所以定义了三种 VSync 请求的类型，这里将 APP 的请求类型定义为一次性使用，所以 APP 每次都要请求<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncRequest </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt; background-color: rgb(255, 242, 204);">VSyncRequest</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">None</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncRequest </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VSyncRequest</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">Single</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">        // std::condition_variable 是条件变量<br />        // 当 std::condition_variable 对象的某个 wait 函数被调用的时候，<br />        // 它使用 std::unique_lock(通过 std::mutex) 来锁住当前线程。<br />        // 当前线程会一直被阻塞，直到另外一个线程在相同的 <br />        // std::condition_variable 对象上调用了 notify 函数来唤醒当前线程。<br /></font></i></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mCondition</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">.</span><span style="background-color: rgb(204, 204, 204);">notify_all</span><span style="background-color: rgb(255, 255, 255);">();<br />    } </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">else if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncRequest </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VSyncRequest</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">SingleSuppressCallback</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        connection</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncRequest </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VSyncRequest</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">Single</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    }<br />}</span></font></pre></pre></pre></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="3392" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 2937 1089 Q 2967 1089 3162 1056.5 Q 3357 1024 3380.63 1024" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 3385.88 1024 L 3378.88 1027.5 L 3380.63 1024 L 3378.88 1020.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2932" cy="1089" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="4187" y="1024" width="640" height="270" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 1024px; margin-left: 4192px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><pre style=""><pre style=""><pre style=""><font face="Consolas"><span style="font-size: 8.3pt; color: rgb(140, 140, 140);">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cpp<br /></span><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">void </span><span style="font-size: 8.3pt; color: rgb(0, 128, 128);">Scheduler</span><font color="#080808" style="font-size: 8.3pt;">::</font><span style="font-size: 8.3pt; color: rgb(0, 98, 122);">resync</span><font color="#080808" style="font-size: 8.3pt;">() {<br /></font><font style="font-size: 8.3pt;" color="#ff0000"><i style="">    // 将 750ms 换算成 ns<br /></i></font><font color="#080808" style="font-size: 8.3pt;">    </font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">static constexpr </span><span style="font-size: 8.3pt; color: rgb(55, 31, 128);">nsecs_t </span><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">kIgnoreDelay </span><font color="#080808" style="font-size: 8.3pt;">= ms2ns(</font><span style="font-size: 8.3pt; color: rgb(23, 80, 235);">750</span><font color="#080808" style="font-size: 8.3pt;">);<br /></font><font style="font-size: 8.3pt;" color="#ff0000"><i style="">    // 获取当前时间<br /></i></font><font color="#080808" style="font-size: 8.3pt;">    </font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">const </span><span style="font-size: 8.3pt; color: rgb(55, 31, 128);">nsecs_t </span><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">now </span><font color="#080808" style="font-size: 8.3pt;">= systemTime();<br />    </font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">const </span><span style="font-size: 8.3pt; color: rgb(55, 31, 128);">nsecs_t </span><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">last </span><span style="font-size: 8.3pt;"><font color="#080808">= mLastResyncTime.exchange(now);<br /></font><i style=""><font color="#ff0000">    // 如果 VSync 间隔超过 750ms，则尝试开启硬件 VSync 信号机制</font></i></span><span style="font-size: 8.3pt;"><i style=""><font color="#ff0000"><br /></font></i><font color="#080808">    </font></span><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">if </span><font color="#080808" style="font-size: 8.3pt;">(</font><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">now </span><font color="#080808" style="font-size: 8.3pt;">- </font><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">last </span><font color="#080808" style="font-size: 8.3pt;">&gt; </font><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">kIgnoreDelay</span><font color="#080808" style="font-size: 8.3pt;">) {<br />        </font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">const auto </span><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">vsyncPeriod </span><font color="#080808" style="font-size: 8.3pt;">= [&amp;] {<br />            std::scoped_lock lock(</font><span style="font-size: 8.3pt; color: rgb(102, 14, 122);">mRefreshRateConfigsLock</span><font color="#080808" style="font-size: 8.3pt;">);<br />            </font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">return </span><span style="font-size: 8.3pt; color: rgb(102, 14, 122);">mRefreshRateConfigs</span><span style="font-size: 8.3pt; color: rgb(0, 128, 128);">-&gt;</span><font color="#080808" style="font-size: 8.3pt;">getCurrentRefreshRate().getVsyncPeriod();<br />        }</font><span style="font-size: 8.3pt; color: rgb(0, 128, 128);">()</span><font style="font-size: 8.3pt;"><font color="#080808">;<br /></font><i style=""><font color="#ff0000">        // 第一个参数判断当前安卓版本是否支持硬件 VSync，此处为 false，所以直接 return 了，不生效。<br /></font></i><font color="#080808">        resyncToHardwareVsync(</font></font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">false</span><font color="#080808" style="font-size: 8.3pt;">, </font><span style="font-size: 8.3pt; color: rgb(0, 0, 0);">vsyncPeriod</span><font color="#080808" style="font-size: 8.3pt;">);<br />    }<br />}</font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4192" y="1036" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\Scheduler.cpp...</text></switch></g><path d="M 3617 1118 Q 3647 1118 3902 1071 Q 4157 1024 4180.63 1024" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4185.88 1024 L 4178.88 1027.5 L 4180.63 1024 L 4178.88 1020.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="3612" cy="1118" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="2727" y="1154" width="620" height="230" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 617px; height: 1px; padding-top: 1154px; margin-left: 2732px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style="color: rgb(51, 51, 51); font-size: 8.3pt;"><pre style="font-size: 12px;"><font face="consolas"><font color="#000000"><span style="font-size: 8.3pt;">【说明信息】</span><span style="font-size: 11.0667px;">VSyncRequest 表示当前 VSync 请求的三种状态：<br />                        None     为初始值<br />                        Single   代表已经请求了一个 VSync，是一次性的<br />                        Periodic 代表请求的是周期性信号<br /></span></font><font color="#8c8c8c" style="font-size: 8.3pt; font-style: italic;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.h<br /></font><span style="font-size: 8.3pt; color: rgb(0, 51, 179);">enum class </span><span style="font-size: 8.3pt; color: rgb(0, 128, 128);">VSyncRequest </span><font color="#080808" style="font-size: 8.3pt;">{<br />    </font><span style="font-size: 8.3pt; color: rgb(135, 16, 148); font-style: italic;">None </span><font color="#080808" style="font-size: 8.3pt;">= -</font><span style="font-size: 8.3pt; color: rgb(23, 80, 235);">2</span><font color="#080808" style="font-size: 8.3pt;">,<br />    </font><span style="font-size: 8.3pt; color: rgb(140, 140, 140); font-style: italic;">// Single wakes up for the next two frames to avoid scheduler overhead<br /></span><span style="font-size: 8.3pt; color: rgb(140, 140, 140); font-style: italic;">    </span><span style="font-size: 8.3pt; color: rgb(135, 16, 148); font-style: italic;">Single </span><font color="#080808" style="font-size: 8.3pt;">= -</font><span style="font-size: 8.3pt; color: rgb(23, 80, 235);">1</span><font color="#080808" style="font-size: 8.3pt;">,<br />    </font><span style="font-size: 8.3pt; color: rgb(140, 140, 140); font-style: italic;">// SingleSuppressCallback only wakes up for the next frame<br /></span><span style="font-size: 8.3pt; color: rgb(140, 140, 140); font-style: italic;">    </span><span style="font-size: 8.3pt; color: rgb(135, 16, 148); font-style: italic;">SingleSuppressCallback </span><font color="#080808" style="font-size: 8.3pt;">= </font><span style="font-size: 8.3pt; color: rgb(23, 80, 235);">0</span><font color="#080808" style="font-size: 8.3pt;">,<br />    </font><span style="font-size: 8.3pt; color: rgb(135, 16, 148); font-style: italic;">Periodic </span><font color="#080808" style="font-size: 8.3pt;">= </font><span style="font-size: 8.3pt; color: rgb(23, 80, 235);">1</span><font color="#080808" style="font-size: 8.3pt;">,<br />    </font><span style="font-size: 8.3pt; color: rgb(140, 140, 140); font-style: italic;">// Subsequent values are periods.<br /></span><font color="#080808" style="font-size: 8.3pt;">};</font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2732" y="1166" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">【说明信息】VSyncRequest 表示当前 VSync 请求的三种状态：...</text></switch></g><path d="M 2877 1249 Q 2907 1249 3272 1224 Q 3637 1199 3660.63 1199" fill="none" stroke="#d6b656" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 3665.88 1199 L 3658.88 1202.5 L 3660.63 1199 L 3658.88 1195.5 Z" fill="#d6b656" stroke="#d6b656" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2872" cy="1249" rx="5" ry="5" fill="#d6b656" stroke="none" pointer-events="all"/><ellipse cx="3672" cy="1199" rx="5" ry="5" fill="#d6b656" stroke="none" pointer-events="all"/><rect x="4187" y="1344" width="680" height="1810" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 1344px; margin-left: 4192px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="consolas" style=""><font color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">EventThread</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-size: 8.3pt;">threadMain</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">unique_lock</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">mutex</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;&amp; lock) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-size: 8.3pt;">DisplayEventConsumers </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">consumers</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">while </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">Quit</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        std::optional&lt;DisplayEventReceiver::Event&gt; event;<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">// Determine next event to dispatch.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mPendingEvents</span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">.empty()) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="">            // 如果 mPendingEvents 不为空，就获取其头部事件，<br />            // 然后寻找能够消耗此事件的 EventThreadConnection，<br />            // 找到了就调用 dispatchEvent 分发事件，如果 mState 为 Idle，<br />            // 就让此线程陷入等待，唤醒条件就是调用 notify 函数<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">            event = mPendingEvents.front();<br />            </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mPendingEvents</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.pop_front();<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">switch </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event-&gt;header.type) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_HOTPLUG:<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event-&gt;hotplug.connected &amp;&amp; !mVSyncState) {<br />                        mVSyncState.emplace(event-&gt;header.displayId);<br />                    } </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">else if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!event-&gt;hotplug.connected &amp;&amp; mVSyncState &amp;&amp;<br />                               mVSyncState-&gt;displayId == event-&gt;header.displayId) {<br />                        mVSyncState.reset();<br />                    }<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">break</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_VSYNC:<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(mInterceptVSyncsCallback) {<br />                        mInterceptVSyncsCallback(event-&gt;header.timestamp);<br />                    }<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">break</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />            }<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">bool </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">vsyncRequested </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">false</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt;"><i>// Find connections that should consume this event.<br /></i></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><font color="#ff3333" style=""><i style="">        // 遍历客户端连接，将有效连接放到 consumers 容器中，consumers 将作为参数传给 dispatchEvent() 方法<br /></i></font></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mDisplayEventConnections</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.begin();<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">while </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">!= </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mDisplayEventConnections</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.end()) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">connection </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">promote()) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">vsyncRequested </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">|= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">connection</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">vsyncRequest </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">None</span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">;<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="">                // shouldConsumeEvent() 方法检查是否需要处理当前 event<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">                </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">(event &amp;&amp;     </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(204, 204, 204);">shouldConsumeEvent</span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">(*event, connection)) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="">                    // 将需要监听 VSync 的连接放到 consumsers 容器中<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">                    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">consumers</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.push_back(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">connection</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                }<br /><br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">++</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />            } </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">else </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mDisplayEventConnections</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.erase(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">it</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            }<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">consumers</span><span style="font-size: 8.3pt;"><font color="#080808" style="background-color: rgb(255, 255, 255);">.empty()) {<br /></font><i style="background-color: rgb(255, 255, 255);"><font color="#ff3333">            // 将 VSync 事件分发给监听端<br /></font></i><font color="#080808" style=""><span style="background-color: rgb(255, 255, 255);">            </span><span style="background-color: rgb(204, 204, 204);">dispatchEvent</span><span style="background-color: rgb(255, 255, 255);">(*event, </span></font></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">consumers</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">consumers</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.clear();<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">nextState</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">(<span class="highlighter--deleted" data-highlight-id="0" style="background-color: inherit; color: inherit;"><span class="highlighter--deleted" data-highlight-id="6" style="background-color: inherit; color: inherit;">mVSyncState</span></span> &amp;&amp; vsyncRequested) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="">            // mVSyncState-&gt;synthetic 会在手机亮屏是被赋值为 false，灭屏时赋值为 true<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">            nextState = mVSyncState-&gt;synthetic ? State::SyntheticVSync : State::VSync;<br />        } </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">else </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-size: 8.3pt; font-weight: bold;">ALOGW_IF</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!mVSyncState, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">"Ignoring VSYNC request while display is disconnected"</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">nextState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">Idle</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">nextState</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">VSync</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mVSyncSource</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">setVSyncEnabled(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">false</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            } </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">else if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">nextState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">VSync</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mVSyncSource</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">setVSyncEnabled(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">true</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            }<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">nextState</span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">;<br />        }<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333">        // 如果 event 不为空，继续处理 mPendingEvents 中的后续事件<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">continue</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">// Wait for event or client registration/request.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">        </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">Idle</span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">) {<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333">            // 阻塞等待客户端请求<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-size: 8.3pt;">            </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mCondition</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.wait(lock);<br />        } </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">else </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">// Generate a fake VSYNC after a long timeout in case the driver stalls. When the<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">            // display is off, keep feeding clients at 60 Hz.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">            </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">chrono</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-size: 8.3pt;">nanoseconds </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">timeout </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">=<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">SyntheticVSync </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-size: 8.3pt;">16</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">ms : </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-size: 8.3pt;">1000</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">ms;<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mCondition</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.wait_for(lock, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">timeout</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) == </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">cv_status</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">timeout</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mState </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">State</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">VSync</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">"Faking VSYNC due to driver stall for thread %s"</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mThreadName</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-size: 8.3pt;">string </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">"VsyncSource debug info:</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 55, 166); font-size: 8.3pt;">\n</span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">"</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mVSyncSource</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">dump(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">// Log the debug info line-by-line to avoid logcat overflow<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">                    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">pos </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.find(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">'</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 55, 166); font-size: 8.3pt;">\n</span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">'</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">while </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">pos </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">std</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-size: 8.3pt;">string</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">npos</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">"%s"</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.substr(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-size: 8.3pt;">0</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">pos</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">).c_str());<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.substr(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">pos </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-size: 8.3pt;">1</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">pos </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">debugInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.find(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">'</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 55, 166); font-size: 8.3pt;">\n</span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-size: 8.3pt;">'</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                    }<br />                }<br /><br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-size: 8.3pt; font-weight: bold;">LOG_FATAL_IF</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!mVSyncState);<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">now </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= systemTime(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">SYSTEM_TIME_MONOTONIC</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">deadlineTimestamp </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">now </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">timeout</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.count();<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">expectedVSyncTime </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">deadlineTimestamp </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">timeout</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.count();<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-size: 8.3pt;">int64_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-size: 8.3pt;">vsyncId </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= [&amp;] {<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">mTokenManager </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">!= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">nullptr</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">mTokenManager-&gt;generateTokenForPredictions(<br />                                {now, deadlineTimestamp, expectedVSyncTime});<br />                    }<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">FrameTimelineInfo</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-size: 8.3pt;">INVALID_VSYNC_ID</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                }</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-size: 8.3pt;">()</span><font color="#080808" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                mPendingEvents.push_back(makeVSync(mVSyncState-&gt;displayId, now,<br />                                                   ++mVSyncState-&gt;count, expectedVSyncTime,<br />                                                   deadlineTimestamp, vsyncId));<br />            }<br />        }<br />    }<br />}</span></font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4192" y="1356" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 3567 1299 Q 3597 1299 3877 1321.5 Q 4157 1344 4180.63 1344" fill="none" stroke="#004c99" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 4185.88 1344 L 4178.88 1347.5 L 4180.63 1344 L 4178.88 1340.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1334px; margin-left: 4091px;"><div data-drawio-colors="color: #FF3333; background-color: #FFFF00; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Consolas; color: rgb(255, 51, 51); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 0); white-space: nowrap;">唤醒</div></div></div></foreignObject><text x="4091" y="1337" fill="#FF3333" font-family="Consolas" font-size="11px" text-anchor="middle">唤醒</text></switch></g><ellipse cx="3562" cy="1299" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="4907" y="2264" width="640" height="370" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 2264px; margin-left: 4912px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThread</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">dispatchEvent</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; event,<br />                                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventConsumers</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; consumers) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">for </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const auto</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">consumer </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: consumers) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">copy </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= event;<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event.header.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">type </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_VSYNC</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">copy</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">vsync</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">frameInterval </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mGetVsyncPeriodFunction</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">(</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">consumer</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mOwnerUid</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">)</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />        }<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">switch </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">consumer</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">-&gt;</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">postEvent</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">copy</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">:<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">-EAGAIN:<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 141, 222); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">TODO: Try again if pipe is full.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 141, 222); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">                </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed dispatching %s for %s"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, toString(event).c_str(),<br />                      toString(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">*</span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">consumer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">).c_str());<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">default</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">:<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Treat EPIPE and other errors as fatal.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">                </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">removeDisplayEventConnectionLocked(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">consumer</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        }<br />    }<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4912" y="2276" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 4347 2169 Q 4377 2169 4627 2216.5 Q 4877 2264 4900.63 2264" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4905.88 2264 L 4898.88 2267.5 L 4900.63 2264 L 4898.88 2260.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="4342" cy="2169" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="5587" y="2264" width="640" height="340" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 637px; height: 1px; padding-top: 2264px; margin-left: 5592px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">EventThreadConnection</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">postEvent</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&amp; event) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">constexpr auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">toStatus </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= [](ssize_t size) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">size &lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0 </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? status_t(size) : status_t(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    };<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event.header.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">type </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_FRAME_RATE_OVERRIDE </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">||<br />        event.header.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">type </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_FRAME_RATE_OVERRIDE_FLUSH</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mPendingEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.emplace_back(event);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(event.header.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">type </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">== </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_FRAME_RATE_OVERRIDE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">NO_ERROR</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        }<br /><br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= DisplayEventReceiver::</span>sendEvents<span style="background-color: rgb(255, 255, 255);">(&amp;mChannel, mPendingEvents.data(),<br />                                                     mPendingEvents.size());<br />        </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mPendingEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.clear();<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">toStatus(size);<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">auto </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= DisplayEventReceiver::</span><span style="background-color: rgb(204, 204, 204);">sendEvents</span><span style="background-color: rgb(255, 255, 255);">(&amp;mChannel, &amp;event, </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">1</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">toStatus(size);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="5592" y="2276" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp...</text></switch></g><path d="M 5137 2399 Q 5167 2399 5362 2331.5 Q 5557 2264 5580.63 2264" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 5585.88 2264 L 5578.88 2267.5 L 5580.63 2264 L 5578.88 2260.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="5132" cy="2399" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6267" y="2264" width="570" height="130" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 567px; height: 1px; padding-top: 2264px; margin-left: 6272px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;"><font color="#cccccc">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp</font></span><span style="font-size: 8.3pt;"><font color="#cccccc"><br /></font><font color="#371f80">ssize_t </font></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">sendEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">gui</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* dataChannel,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt;">count)<br />{<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font face="consolas" style="" color="#ff3333">    // sendObjects() 和 recvObjects() 对应，sendObjects() 函数再调用内部 write() 函数<br /></font></i></span><span style="background-color: rgb(255, 255, 255); color: rgb(8, 8, 8); font-family: Consolas, monospace; font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">gui</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">::</span><span style="background-color: rgb(204, 204, 204);">sendObjects</span><span style="background-color: rgb(255, 255, 255);">(dataChannel, events, count);<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6272" y="2276" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cppssize_t DisplayEve...</text></switch></g><path d="M 5907 2559 Q 5937 2559 6087 2411.5 Q 6237 2264 6260.63 2264" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6265.88 2264 L 6258.88 2267.5 L 6260.63 2264 L 6258.88 2260.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="5902" cy="2559" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="6987" y="2264" width="520" height="210" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 517px; height: 1px; padding-top: 2264px; margin-left: 6992px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas" style=""><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255);">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp<br /></span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">ssize_t </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">BitTube</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">::</span><span style="color: rgb(0, 98, 122); font-size: 8.3pt; background-color: rgb(255, 255, 255);">write</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">(</span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">void const</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">* vaddr, </span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">size_t </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">size) {<br />    </span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">ssize_t </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">, </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">len</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">do </span><span style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><font color="#080808">{<br /></font><font color="#ff0000"><i>        // </i></font></span><font color="#ff0000"><i><span style="font-size: 11.0667px;">mReceiveFd 会被添加到 handler 的 epoll 中进行监听<br /></span><span style="font-size: 8.3pt;">        // </span><span style="font-size: 11.0667px;">所以当 mSendFd 写入数据之后，对应的 mReceiveFd 就能收到，<br />        // 并回调 D</span></i></font></span></font><i style="font-size: 11.0667px; color: rgb(255, 0, 0); background-color: rgb(255, 255, 255); font-family: Consolas;">isplayEventDispatcher::</i><font color="#ff0000" face="Consolas"><span style="font-size: 11.0667px;"><i>handleEvent() 方法</i></span></font><font face="Consolas" style=""><span style="background-color: rgb(255, 255, 255);"><font color="#ff0000"><i><span style="font-size: 11.0667px;"><br /></span></i></font></span></font><font face="Consolas" style=""><span style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><font color="#080808">        len =     </font></span></span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 0);">::send(mSendFd, vaddr, size, <span style="color: rgb(31, 84, 46); font-weight: bold;">MSG_DONTWAIT </span>| <span style="color: rgb(31, 84, 46); font-weight: bold;">MSG_NOSIGNAL</span>)</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />        </span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-style: italic;">// cannot return less than size, since we're using SOCK_SEQPACKET<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-style: italic;">        </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err = len &lt; </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0 </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">? </span><span style="color: rgb(31, 84, 46); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-weight: bold;">errno </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">: </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />    } </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">while </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">(err == EINTR);<br />    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">return </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">== </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0 </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">? </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">len </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">: -</span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6992" y="2276" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp...</text></switch></g><rect x="6277" y="2394" width="670" height="230" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 667px; height: 1px; padding-top: 2394px; margin-left: 6282px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">sendObjects</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* tube, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void const</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">count, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">objSize) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const char</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vaddr </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">reinterpret_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const char</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">*&gt;(events);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= tube-&gt;</span><span style="background-color: rgb(204, 204, 204);">write</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vaddr</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, count * objSize);<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// should never happen because of SOCK_SEQPACKET<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">LOG_ALWAYS_FATAL_IF</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">((</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) &amp;&amp; (</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">% </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(objSize)),<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"BitTube::sendObjects(count=%zu, size=%zu), res=%zd (partial events were "<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">                        "sent!)"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />                        count, objSize, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// ALOGE_IF(size&lt;0, "error %d sending %d events", size, count);<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0 </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">/ </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(objSize);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="6282" y="2406" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cppssize_t BitTube::sendObjects(BitTube* tube, voi...</text></switch></g><path d="M 6477 2459 Q 6507 2459 6732 2361.5 Q 6957 2264 6980.63 2264" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 6985.88 2264 L 6978.88 2267.5 L 6980.63 2264 L 6978.88 2260.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="6472" cy="2459" rx="5" ry="5" fill="#004c99" stroke="none" pointer-events="all"/><rect x="27" y="1764" width="650" height="20" fill="#ffff00" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 652px; height: 1px; padding-top: 1774px; margin-left: 27px;"><div data-drawio-colors="color: #FF0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">【进程信息】com.blackshark.mola@main：SF 端向 mSendFd 写入数据后，Looper 监听 epoll 回调</div></div></div></foreignObject><text x="27" y="1778" fill="#FF0000" font-family="Helvetica" font-size="12px">【进程信息】com.blackshark.mola@main：SF 端向 mSendFd 写入数据后，Looper 监听 epoll 回调</text></switch></g><rect x="27" y="1784" width="680" height="520" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 1784px; margin-left: 32px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">handleEvent</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">*) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(events &amp; (</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Looper</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">EVENT_ERROR </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">| </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Looper</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">EVENT_HANGUP</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Display event receiver pipe was closed or an error occurred.  "<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">              "events=0x%x"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />              events);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// remove the callback<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">}<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(!(events &amp; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Looper</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(135, 16, 148); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">EVENT_INPUT</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Received spurious callback for unhandled poll event.  "<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">              "events=0x%x"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />              events);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">1</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// keep the callback<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">}<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Drain all pending events, keep the last vsync.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">nsecs_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncTimestamp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    PhysicalDisplayId vsyncDisplayId;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncCount</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncEventData </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncEventData</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas">    // 通过 mReceiver.getEvents 获取 VSync 事件，即通过 BitTube 获取 SF 写入的 VSync 事件<br />    // 如果缓存中有多个 VSync，这里只取最新的一次 VSync 事件<br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">(    </span><span style="background-color: rgb(204, 204, 204);">processPendingEvents</span><span style="background-color: rgb(255, 255, 255);">(&amp;vsyncTimestamp, &amp;vsyncDisplayId, &amp;vsyncCount, &amp;vsyncEventData)) {<br />        </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ Vsync pulse: timestamp=%" </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">PRId64<br />              </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">", displayId=%s, count=%d, vsyncId=%" </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">PRId64,<br />              </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, ns2ms(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncTimestamp</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">), to_string(vsyncDisplayId).</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">c_str</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(), </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncCount</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />              </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vsyncEventData</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">.</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">id</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-family: Consolas, monospace; font-size: 8.3pt;">mWaitingForVsync </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">false</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">;<br />        </span><span style="background-color: rgb(204, 204, 204);">dispatchVsync</span><span style="background-color: rgb(255, 255, 255);">(vsyncTimestamp, vsyncDisplayId, vsyncCount, vsyncEventData);<br />    }<br /><br />    </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">1</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// keep the callback<br /></span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="32" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp...</text></switch></g><rect x="747" y="2364" width="650" height="360" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 647px; height: 1px; padding-top: 2364px; margin-left: 752px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre><pre style=""><pre style="font-size: 8.3pt;"><pre style="font-size: 8.3pt;"><font face="Consolas"><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140);">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179);">void </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128);">NativeDisplayEventReceiver</span><font color="#080808" style="background-color: rgb(255, 255, 255);">::</font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122);">dispatchVsync</span><font color="#080808" style="background-color: rgb(255, 255, 255);">(</font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128);">nsecs_t </span><font color="#080808" style="background-color: rgb(255, 255, 255);">timestamp, PhysicalDisplayId displayId,<br />                                               </font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128);">uint32_t </span><font color="#080808" style="background-color: rgb(255, 255, 255);">count, </font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128);">VsyncEventData </span><font color="#080808" style="background-color: rgb(255, 255, 255);">vsyncEventData) {<br />    JNIEnv* </font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">env </span><font color="#080808" style="background-color: rgb(255, 255, 255);">= AndroidRuntime::getJNIEnv();<br /><br />    ScopedLocalRef&lt;jobject&gt; receiverObj(env, jniGetReferent(env, mReceiverWeakGlobal));<br />    </font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179);">if </span><font color="#080808" style="background-color: rgb(255, 255, 255);">(receiverObj.get()) {<br />        </font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-weight: bold;">ALOGV</span><font color="#080808" style="background-color: rgb(255, 255, 255);">(</font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23);">"receiver %p ~ Invoking vsync handler."</span><font color="#080808" style="background-color: rgb(255, 255, 255);">, </font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179);">this</span><font style="background-color: rgb(255, 255, 255);"><font color="#080808">);<br /></font><i style=""><font color="#ff0000">        // 回调 JAVA 层方法定义如下：<br />        </font></i></font><i><font color="#ff0000"><span style="background-color: rgb(255, 255, 255);">// int </span><span style="background-color: rgb(255, 255, 255);">register_android_view_DisplayEventReceiver</span><span style="background-color: rgb(255, 255, 255);">(JNIEnv* env) {<br /></span><span style="background-color: rgb(255, 255, 255);">        //     jclass clazz = FindClassOrDie(env, </span><span style="background-color: rgb(255, 255, 255);">"android/view/DisplayEventReceiver"</span><span style="background-color: rgb(255, 255, 255);">);<br /></span><span style="background-color: rgb(255, 255, 255);">        //     gDisplayEventReceiverClassInfo.clazz = MakeGlobalRefOrDie(env, clazz);<br /></span><span style="background-color: rgb(255, 255, 255);">        //     </span><span style="background-color: rgb(255, 255, 255);">gDisplayEventReceiverClassInfo.dispatchVsync</span><span style="background-color: rgb(255, 255, 255);"> = GetMethodIDOrDie(env, <br /></span><span style="background-color: rgb(255, 255, 255);">        //             gDisplayEventReceiverClassInfo.clazz, </span><span style="background-color: rgb(255, 255, 255);">"dispatchVsync"</span><span style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255);">"(JJIJJJ)V"</span><span style="background-color: rgb(255, 255, 255);">);<br /></span><span style="background-color: rgb(255, 255, 255);">        // }<br /></span></font></i><span style="color: rgb(140, 140, 140); font-style: italic;">        </span><font color="#080808" style="">env-&gt;<span style="background-color: rgb(204, 204, 204);">CallVoidMethod</span>(receiverObj.get(), gDisplayEventReceiverClassInfo.dispatchVsync,<br /><span style="background-color: rgb(255, 255, 255);">                            timestamp, displayId.value, count, vsyncEventData.id,<br />                            vsyncEventData.deadlineTimestamp, vsyncEventData.frameInterval);<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-weight: bold;">ALOGV</span><font color="#080808" style="background-color: rgb(255, 255, 255);">(</font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23);">"receiver %p ~ Returned from vsync handler."</span><font color="#080808" style="background-color: rgb(255, 255, 255);">, </font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179);">this</span><font color="#080808" style="background-color: rgb(255, 255, 255);">);<br />    }<br /><br />    mMessageQueue-&gt;raiseAndClearException(env, </font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23);">"dispatchVsync"</span><font color="#080808" style="background-color: rgb(255, 255, 255);">);<br />}</font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="752" y="2376" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\jni\android_view_DisplayEventReceiver.cpp...</text></switch></g><path d="M 167 2219 Q 197 2219 457 2291.5 Q 717 2364 740.63 2364" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 745.88 2364 L 738.88 2367.5 L 740.63 2364 L 738.88 2360.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="162" cy="2219" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="1467" y="2364" width="620" height="140" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 617px; height: 1px; padding-top: 2364px; margin-left: 1472px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\DisplayEventReceiver.java<br /></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// Called from native code.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 0);">@SuppressWarnings</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"unused"</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)<br /></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private void </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">dispatchVsync(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">timestampNanos, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">physicalDisplayId, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">frame,<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">frameTimelineVsyncId, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">frameDeadline, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">frameInterval) {<br />    </span><span style="background-color: rgb(204, 204, 204);">onVsync</span><span style="background-color: rgb(255, 255, 255);">(timestampNanos, physicalDisplayId, frame,<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">VsyncEventData(frameTimelineVsyncId, frameDeadline, frameInterval));<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1472" y="2376" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\DisplayEventReceiver.java...</text></switch></g><path d="M 927 2593 Q 957 2593 1197 2478.5 Q 1437 2364 1460.63 2364" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1465.88 2364 L 1458.88 2367.5 L 1460.63 2364 L 1458.88 2360.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="922" cy="2593" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2147" y="2364" width="650" height="790" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 647px; height: 1px; padding-top: 2364px; margin-left: 2152px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java<br /></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private final class </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">FrameDisplayEventReceiver </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">extends </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">implements </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">Runnable {<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private boolean </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHavePendingVsync</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private long </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mTimestampNanos</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private int </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mFrame</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">private </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">VsyncEventData </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mLastVsyncEventData </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">new </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">VsyncEventData();<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">FrameDisplayEventReceiver(Looper looper, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">vsyncSource) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">super</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(looper, vsyncSource, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 255);">0</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />    }<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 115, 191); font-weight: bold; font-style: italic;">TODO(b/116025192): physicalDisplayId is ignored because SF only emits VSYNC events for<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 115, 191); font-weight: bold; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// the internal display and DisplayEventReceiver#scheduleVsync only allows requesting VSYNC<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">    // for the internal display implicitly.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 0);">@Override<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 0);">    </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">public void </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">onVsync(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">timestampNanos, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">physicalDisplayId, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">int </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">frame,<br />            VsyncEventData vsyncEventData) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">try </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">isTagEnabled</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TRACE_TAG_VIEW</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)) {<br />                Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">traceBegin</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TRACE_TAG_VIEW</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />                        </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"Choreographer#onVsync " </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ vsyncEventData.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">id</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            }<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">// Post the vsync event to the Handler.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">            // The idea is to prevent incoming vsync events from completely starving<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">            // the message queue.  If there are no messages in the queue with timestamps<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">            // earlier than the frame time, then the vsync event will be processed immediately.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">            // Otherwise, messages that predate the vsync event will be handled first.<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(128, 128, 128); font-style: italic;">            </span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">long </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">now = System.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">nanoTime</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">();<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(timestampNanos &gt; now) {<br />                Log.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">w</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TAG</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"Frame time is " </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ ((timestampNanos - now) * </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 255);">0.000001f</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">)<br />                        + </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">" ms in the future!  Check that graphics HAL is generating vsync "<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">                        </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"timestamps using the correct timebase."</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />                timestampNanos = now;<br />            }<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">if </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHavePendingVsync</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />                Log.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">w</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TAG</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"Already have a pending vsync event.  There should only be "<br /></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">                        </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">+ </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 128, 0); font-weight: bold;">"one at a time."</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            } </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">else </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />                </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHavePendingVsync </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">true</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />            }<br /><br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mTimestampNanos </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= timestampNanos;<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mFrame </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= frame;<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mLastVsyncEventData </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= vsyncEventData;<br />            Message msg = Message.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">obtain</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHandler</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">this</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            msg.setAsynchronous(</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">true</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />            </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold;">mHandler</span><font face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">.</span><span style="background-color: rgb(204, 204, 204);">sendMessageAtTime</span><span style="background-color: rgb(255, 255, 255);">(msg, timestampNanos / TimeUtils.</span></span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">NANOS_PER_MS</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        } </span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(0, 0, 128); font-weight: bold;">finally </span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br />            Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">traceEnd</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(Trace.</span></font><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; font-size: 8.3pt; color: rgb(102, 14, 122); font-weight: bold; font-style: italic;">TRACE_TAG_VIEW</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br />        }<br />    }</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2152" y="2376" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java...</text></switch></g><path d="M 1547 2459 Q 1577 2459 1847 2411.5 Q 2117 2364 2140.63 2364" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2145.88 2364 L 2138.88 2367.5 L 2140.63 2364 L 2138.88 2360.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="1542" cy="2459" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2867" y="2364" width="570" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 567px; height: 1px; padding-top: 2364px; margin-left: 2872px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre><pre style=""><pre style="font-family: &quot;JetBrains Mono&quot;, monospace; font-size: 8.3pt;"><pre style="font-family: &quot;JetBrains Mono&quot;, monospace; font-size: 8.3pt;"><pre style="font-family: Consolas, monospace; font-size: 8.3pt;"><pre style="font-family: Consolas, monospace; font-size: 8.3pt;"><pre style="font-family: Consolas, monospace; font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 128); font-style: italic;">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(128, 128, 0);">@Override<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold;">public void </span><span style="background-color: rgb(255, 255, 255);">run() {<br />    </span><span style="background-color: rgb(255, 255, 255); color: rgb(102, 14, 122); font-weight: bold;">mHavePendingVsync </span><span style="background-color: rgb(255, 255, 255);">= </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 128); font-weight: bold;">false</span><span style="background-color: rgb(255, 255, 255);">;<br /></span>    doFrame(<span style="color: rgb(102, 14, 122); font-weight: bold;">mTimestampNanos</span>, <span style="color: rgb(102, 14, 122); font-weight: bold;">mFrame</span>, <span style="color: rgb(102, 14, 122); font-weight: bold;">mLastVsyncEventData</span>);<br /><span style="background-color: rgb(255, 255, 255);">}</span></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2872" y="2376" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\base\core\java\android\view\Choreographer.java...</text></switch></g><path d="M 2397 3069 Q 2427 3069 2632 2716.5 Q 2837 2364 2860.63 2364" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 2865.88 2364 L 2858.88 2367.5 L 2860.63 2364 L 2858.88 2360.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2392" cy="3069" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="4907" y="1344" width="720" height="850" fill="rgb(255, 255, 255)" stroke="#004c99" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 717px; height: 1px; padding-top: 1344px; margin-left: 4912px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style="background-color: rgb(255, 255, 255);"><font face="consolas"><font color="#cccccc"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cpp</span><span style="font-size: 8.3pt;"><br /></span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">bool </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">EventThread</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 98, 122); font-size: 8.3pt;">shouldConsumeEvent</span><font color="#080808"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">const </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">Event</span><font color="#080808"><span style="font-size: 8.3pt;">&amp; event,<br />                                     </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">const </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">sp</span><font color="#080808"><span style="font-size: 8.3pt;">&lt;</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">EventThreadConnection</span><font color="#080808"><span style="font-size: 8.3pt;">&gt;&amp; connection) </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">const </span><font color="#080808"><span style="font-size: 8.3pt;">{<br />    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">const auto </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt;">throttleVsync </span><font color="#080808"><span style="font-size: 8.3pt;">= [&amp;] {<br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">mThrottleVsyncCallback </span><font color="#080808"><span style="font-size: 8.3pt;">&amp;&amp;<br />                </span></font><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">mThrottleVsyncCallback</span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">(</span><font color="#080808"><span style="font-size: 8.3pt;">event.</span></font><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsync</span><font color="#080808"><span style="font-size: 8.3pt;">.</span></font><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">expectedVSyncTimestamp</span><font color="#080808"><span style="font-size: 8.3pt;">, connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">mOwnerUid</span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">)</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />    };<br /><br />    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">switch </span><font color="#080808"><span style="font-size: 8.3pt;">(event.header.</span></font><span style="color: rgb(0, 0, 0); font-size: 8.3pt;">type</span><font color="#080808"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_HOTPLUG</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />            </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return true</span><font color="#080808"><span style="font-size: 8.3pt;">;<br /><br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_MODE_CHANGE</span><font color="#080808"><span style="font-size: 8.3pt;">: {<br />            </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><font color="#080808"><span style="font-size: 8.3pt;">connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">mEventRegistration</span><font color="#080808"><span style="font-size: 8.3pt;">.test(<br />                    </span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">EventRegistration</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">modeChanged</span><font color="#080808"><span style="font-size: 8.3pt;">);<br />        }<br /><br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_VSYNC</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />            </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">switch </span><font color="#080808"><span style="font-size: 8.3pt;">(connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">) {<br />                </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">None</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />                    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return false</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">SingleSuppressCallback</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />                    connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsyncRequest </span><font color="#080808"><span style="font-size: 8.3pt;">= </span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">None</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return false</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">Single</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt;">: {<br /></span><span style="font-size: 11.0667px;"><i style=""><font color="#ff3333" style="">                    // 由于 ro.surface_flinger.enable_frame_rate_override 为空，系统不支持帧率重载，<br />                    // throttleVsync() 方法是一个空方法，范围为 0 即 false，此处不执行。<br />                    // 当系统支持帧率重载时，有三个地方可以控制帧率，即：<br />                    // mRefreshRateConfigs，mFrameRateOverridesFromBackdoor，mFrameRateOverridesByContent <br /></font></i></span><span style="color: rgb(8, 8, 8); font-size: 8.3pt;">                    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808"><span style="font-size: 8.3pt;">(      </span></font><span style="color: rgb(0, 0, 0); font-size: 8.3pt;">throttleVsync</span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">()</span><font color="#080808"><span style="font-size: 8.3pt;">) {<br />                        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return false</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                    }<br />                    connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsyncRequest </span><font color="#080808"><span style="font-size: 8.3pt;">= </span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">SingleSuppressCallback</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return true</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                }<br />                </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">VSyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">Periodic</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />                    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">if </span><font color="#080808"><span style="font-size: 8.3pt;">(</span></font><span style="color: rgb(0, 0, 0); font-size: 8.3pt;">throttleVsync</span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">()</span><font color="#080808"><span style="font-size: 8.3pt;">) {<br />                        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return false</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                    }<br />                    </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return true</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />                </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">default</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />                    </span></font><span style="color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">// We don't throttle vsync if the app set a vsync request rate<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">                    // since there is no easy way to do that and this is a very<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">                    // rare case<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; font-style: italic;">                    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><font color="#080808"><span style="font-size: 8.3pt;">event.</span></font><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsync</span><font color="#080808"><span style="font-size: 8.3pt;">.</span></font><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">count </span><font color="#080808"><span style="font-size: 8.3pt;">% vsyncPeriod(connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">vsyncRequest</span><font color="#080808"><span style="font-size: 8.3pt;">) == </span></font><span style="color: rgb(23, 80, 235); font-size: 8.3pt;">0</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />            }<br /><br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_FRAME_RATE_OVERRIDE</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />            [[fallthrough]];<br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">case </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">DISPLAY_EVENT_FRAME_RATE_OVERRIDE_FLUSH</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />            </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return </span><font color="#080808"><span style="font-size: 8.3pt;">connection</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">-&gt;</span><span style="color: rgb(102, 14, 122); font-size: 8.3pt;">mEventRegistration</span><font color="#080808"><span style="font-size: 8.3pt;">.test(<br />                    </span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">ISurfaceComposer</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(0, 128, 128); font-size: 8.3pt;">EventRegistration</span><font color="#080808"><span style="font-size: 8.3pt;">::</span></font><span style="color: rgb(135, 16, 148); font-size: 8.3pt; font-style: italic;">frameRateOverride</span><font color="#080808"><span style="font-size: 8.3pt;">);<br /><br />        </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">default</span><font color="#080808"><span style="font-size: 8.3pt;">:<br />            </span></font><span style="color: rgb(0, 51, 179); font-size: 8.3pt;">return false</span><font color="#080808"><span style="font-size: 8.3pt;">;<br />    }<br />}</span></font></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="4912" y="1356" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\services\surfaceflinger\Scheduler\EventThread.cppbool EventThread::shouldCon...</text></switch></g><path d="M 4457 1979 Q 4487 1979 4682 1661.5 Q 4877 1344 4900.63 1344" fill="none" stroke="#004c99" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 4905.88 1344 L 4898.88 1347.5 L 4900.63 1344 L 4898.88 1340.5 Z" fill="#004c99" stroke="#004c99" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="4452" cy="1979" rx="5" ry="5" fill="#004c99" stroke="#004c99" pointer-events="all"/><rect x="747" y="1784" width="630" height="530" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 627px; height: 1px; padding-top: 1784px; margin-left: 752px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">bool </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventDispatcher</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">processPendingEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">nsecs_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outTimestamp,<br />                                                  PhysicalDisplayId* outDisplayId,<br />                                                  </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">uint32_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outCount,<br />                                                  </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">VsyncEventData</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* outVsyncEventData) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">bool </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">gotVsync </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">false</span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;</span><span style="background-color: rgb(255, 255, 255); font-size: 11.0667px;"><i style=""><font color="#ff3333" style="" face="consolas"><br /></font></i></span><span style="background-color: rgb(255, 255, 255); font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">buf</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">[</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">EVENT_BUFFER_SIZE</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">];<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">while </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">((n = mReceiver.</span><span style="background-color: rgb(204, 204, 204);">getEvents</span><span style="background-color: rgb(255, 255, 255);">(buf, EVENT_BUFFER_SIZE)) &gt; </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGV</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"dispatcher %p ~ Read %d events."</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">this</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">int</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">(n));<br />        mFrameRateOverrides.reserve(n);<br /></span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">for </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ssize_t i = </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">; i &lt; n; i++) {<br />            </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">const </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 242, 204);">DisplayEventReceiver::Event</span><span style="background-color: rgb(255, 255, 255);">&amp; ev = buf[i];<br />            </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">switch </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(ev.header.type) {<br />                </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">case </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">DisplayEventReceiver::DISPLAY_EVENT_VSYNC:<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// Later vsync events will just overwrite the info from earlier<br /></span><span style="background-color: rgb(255, 255, 255); font-size: 8.3pt;"><i style="font-family: Consolas, monospace; color: rgb(140, 140, 140);">                    // ones. That's fine, we only care about the most recent.<br /></i><font color="#ff3333" style="" face="consolas"><i style="">                    // 将 VSync 的相关信息传给调用者<br /></i></font></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">                    </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">gotVsync = </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">true</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">;<br />                    *outTimestamp = ev.header.timestamp;<br />                    *outDisplayId = ev.header.displayId;<br />                    *outCount = ev.vsync.count;<br />                    outVsyncEventData-&gt;id = ev.vsync.vsyncId;<br />                    outVsyncEventData-&gt;deadlineTimestamp = ev.vsync.deadlineTimestamp;<br />                    outVsyncEventData-&gt;frameInterval = ev.vsync.frameInterval;<br />                    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">break</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><font color="#080808">;<br />                </font><font color="#0033b3">...</font></span></font><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><br />            }<br />        }<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">if </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">ALOGW</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"Failed to get events from display event dispatcher, status=%d"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">status_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">n</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">));<br />    }<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">gotVsync</span><font style="background-color: rgb(255, 255, 255);"><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;">;<br />}</span><span style="font-family: Consolas, monospace; color: rgb(8, 8, 8); font-size: 8.3pt;"><br /></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="752" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventDispatcher.cpp...</text></switch></g><path d="M 217 2129 Q 247 2129 482 1956.5 Q 717 1784 740.63 1784" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 745.88 1784 L 738.88 1787.5 L 740.63 1784 L 738.88 1780.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="212" cy="2129" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><path d="M 7127 2389 L 7102 2389 Q 7092 2389 7092 2399 L 7092 3194 Q 7092 3204 7082 3204 L 17 3204 Q 7 3204 7 3194 L 7 1829 Q 7 1819 17 1819 L 30.63 1819" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 35.88 1819 L 28.88 1822.5 L 30.63 1819 L 28.88 1815.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="7132" cy="2389" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><ellipse cx="42" cy="1819" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="4377" y="1969" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1979px; margin-left: 4378px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-6</div></div></div></foreignObject><text x="4392" y="1983" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-6</text></switch></g><rect x="57" y="1204" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1214px; margin-left: 58px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-1</div></div></div></foreignObject><text x="72" y="1218" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-1</text></switch></g><rect x="2317" y="1093" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1103px; margin-left: 2318px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-2</div></div></div></foreignObject><text x="2332" y="1107" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-2</text></switch></g><rect x="3417" y="1289" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1299px; margin-left: 3418px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-3</div></div></div></foreignObject><text x="3432" y="1303" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-3</text></switch></g><rect x="4247" y="1534" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1544px; margin-left: 4248px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-5</div></div></div></foreignObject><text x="4262" y="1548" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-5</text></switch></g><rect x="4237" y="2154" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2164px; margin-left: 4238px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-7</div></div></div></foreignObject><text x="4252" y="2168" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-7</text></switch></g><rect x="6443" y="2460" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2470px; margin-left: 6444px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-8</div></div></div></foreignObject><text x="6458" y="2474" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-8</text></switch></g><rect x="7080" y="2374" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2384px; margin-left: 7081px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-9</div></div></div></foreignObject><text x="7095" y="2388" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-9</text></switch></g><rect x="207" y="1794" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1804px; margin-left: 208px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">2-1</div></div></div></foreignObject><text x="222" y="1808" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2-1</text></switch></g><rect x="83" y="2124" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2134px; margin-left: 84px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">2-2</div></div></div></foreignObject><text x="98" y="2138" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2-2</text></switch></g><rect x="917" y="1895" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1905px; margin-left: 918px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">2-3</div></div></div></foreignObject><text x="932" y="1909" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2-3</text></switch></g><rect x="1437" y="1884" width="530" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 527px; height: 1px; padding-top: 1884px; margin-left: 1442px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">getEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">gui</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* dataChannel,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">count)<br />{<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">gui</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">::</span><span style="background-color: rgb(204, 204, 204);">recvObjects</span><span style="background-color: rgb(255, 255, 255);">(dataChannel, events, count);<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1442" y="1896" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp...</text></switch></g><rect x="1427" y="1784" width="540" height="100" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 537px; height: 1px; padding-top: 1784px; margin-left: 1432px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">getEvents</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">DisplayEventReceiver</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Event</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events,<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">count) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">DisplayEventReceiver::</span><span style="background-color: rgb(204, 204, 204);">getEvents</span><span style="background-color: rgb(255, 255, 255);">(mDataChannel.get(), events, count);<br />}</span></span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="1432" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\DisplayEventReceiver.cpp...</text></switch></g><rect x="2027" y="1784" width="660" height="170" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 657px; height: 1px; padding-top: 1784px; margin-left: 2032px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\include\private\gui\BitTube.h<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">class </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">public </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">Parcelable </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">{<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">public</span><font face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><font color="#080808">:<br />    </font><font color="#8c8c8c"><i>...</i></font></span></font><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// receive objects (sized blobs). If the receiving buffer isn't large enough, excess messages<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    // are silently discarded.<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">template </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">typename </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">T</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static </span><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">recvObjects</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* tube, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">T</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">count) {<br />        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(204, 204, 204);">recvObjects</span><span style="background-color: rgb(255, 255, 255);">(tube, events, count, </span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">sizeof</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">T</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">));<br />    }</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2032" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\include\private\gui\BitTube.h...</text></switch></g><path d="M 1677 1959 Q 1707 1959 1852 1871.5 Q 1997 1784 2020.63 1784" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2025.88 1784 L 2018.88 1787.5 L 2020.63 1784 L 2018.88 1780.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="1672" cy="1959" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="2747" y="1784" width="670" height="230" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 667px; height: 1px; padding-top: 1784px; margin-left: 2752px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas, monospace" color="#cccccc" style="background-color: rgb(255, 255, 255);"><span style="font-size: 11.0667px;">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp<br /></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">::</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 98, 122); font-family: Consolas, monospace; font-size: 8.3pt;">recvObjects</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">(</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 128, 128); font-family: Consolas, monospace; font-size: 8.3pt;">BitTube</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* tube, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">void</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* events, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">count, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">size_t </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">objSize) {<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">char</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">* </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vaddr </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">reinterpret_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">char</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">*&gt;(events);<br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style=""><span style="font-size: 8.3pt;"><span style="background-color: rgb(255, 255, 255);">= tube-&gt;</span><span style="background-color: rgb(204, 204, 204);">read</span><span style="background-color: rgb(255, 255, 255);">(</span></span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">vaddr</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">, count * objSize);<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// should never happen because of SOCK_SEQPACKET<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(31, 84, 46); font-family: Consolas, monospace; font-size: 8.3pt; font-weight: bold;">LOG_ALWAYS_FATAL_IF</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">((</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;= </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">) &amp;&amp; (</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">% </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(objSize)),<br />                        </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">"BitTube::recvObjects(count=%zu, size=%zu), res=%zd (partial events were "<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(6, 125, 23); font-family: Consolas, monospace; font-size: 8.3pt;">                        "received!)"</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">,<br />                        count, objSize, </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">);<br /><br />    </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">// ALOGE_IF(size&lt;0, "error %d receiving %d events", size, count);<br /></span><span style="background-color: rgb(255, 255, 255); color: rgb(140, 140, 140); font-family: Consolas, monospace; font-size: 8.3pt; font-style: italic;">    </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">return </span><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt; </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(23, 80, 235); font-family: Consolas, monospace; font-size: 8.3pt;">0 </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">? </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">: </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Consolas, monospace; font-size: 8.3pt;">size </span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">/ </span></font><span style="background-color: rgb(255, 255, 255); color: rgb(0, 51, 179); font-family: Consolas, monospace; font-size: 8.3pt;">static_cast</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&lt;</span></font><span style="background-color: rgb(255, 255, 255); color: rgb(55, 31, 128); font-family: Consolas, monospace; font-size: 8.3pt;">ssize_t</span><font color="#080808" face="Consolas, monospace" style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;">&gt;(objSize);<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="2752" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp...</text></switch></g><path d="M 2197 1919 Q 2227 1919 2472 1851.5 Q 2717 1784 2740.63 1784" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 2745.88 1784 L 2738.88 1787.5 L 2740.63 1784 L 2738.88 1780.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2192" cy="1919" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="3467" y="1784" width="680" height="340" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 677px; height: 1px; padding-top: 1784px; margin-left: 3472px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><pre style=""><font face="Consolas" style=""><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255);">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp<br /></span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">ssize_t </span><span style="color: rgb(0, 128, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">BitTube</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">::</span><span style="color: rgb(0, 98, 122); font-size: 8.3pt; background-color: rgb(255, 255, 255);">read</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">(</span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">void</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">* vaddr, </span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">size_t </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">size) {<br />    </span><span style="color: rgb(55, 31, 128); font-size: 8.3pt; background-color: rgb(255, 255, 255);">ssize_t </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">, </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">len</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">do </span><span style="background-color: rgb(255, 255, 255);"><span style="font-size: 8.3pt;"><font color="#080808">{<br /></font></span><i style=""><font color="#ff0000" style=""><span style="font-size: 8.3pt;">        // </span><span style="font-size: 11.0667px;">socket 在内核中有一个发送缓冲区和一个接收缓冲区，send() 函数负责将数据存入 socket 的发送缓冲区，<br />        // recv() 函数负责从 socket 的接收缓冲区中将数据拷贝到用户空间，<br />        // recv() 和 send() 不一定一一对应，即并不是 send() 一次，就一定 recv() 一次接收完，<br />        // 有可能 send() 一次，recv() 多次才能接收完，也可能 send() 多次，一次 recv() 就接收完了<br />        //<br />        // recv() 系统调用将 mReceiveFd 接收到的数据，放入大小为 size 的 vaddr 缓冲区，<br />        // 最后返回其实际接收的字节数，如果 recv() 在接收数据时出错，那么它返回 SOCKET_ERROR（-1），<br />        // 如果 recv() 在等待接收数据时网络中断了，那么它返回 0。<br /></span></font></i><font color="#080808" style="font-size: 8.3pt;">        len =     </font></span><span style="color: rgb(8, 8, 8); font-size: 8.3pt;">::recv(mReceiveFd, vaddr, size, <span style="color: rgb(31, 84, 46); font-weight: bold;">MSG_DONTWAIT</span>);</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);"><br />        err = len &lt; </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0 </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">? </span><span style="color: rgb(31, 84, 46); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-weight: bold;">errno </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">: </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />    } </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">while </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">(err == EINTR);<br />    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">if </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">(</span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">== EAGAIN || </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">== EWOULDBLOCK) {<br />        </span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-style: italic;">// EAGAIN means that we have non-blocking I/O but there was no data to be read. Nothing the<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-style: italic;">        // client should care about.<br /></span><span style="color: rgb(140, 140, 140); font-size: 8.3pt; background-color: rgb(255, 255, 255); font-style: italic;">        </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">return </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />    }<br />    </span><span style="color: rgb(0, 51, 179); font-size: 8.3pt; background-color: rgb(255, 255, 255);">return </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">== </span><span style="color: rgb(23, 80, 235); font-size: 8.3pt; background-color: rgb(255, 255, 255);">0 </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">? </span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">len </span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">: -</span><span style="color: rgb(0, 0, 0); font-size: 8.3pt; background-color: rgb(255, 255, 255);">err</span><span style="color: rgb(8, 8, 8); font-size: 8.3pt; background-color: rgb(255, 255, 255);">;<br />}</span></font></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></pre></div></div></div></foreignObject><text x="3472" y="1796" fill="rgb(0, 0, 0)" font-family="Courier New" font-size="12px">// aosp_android-12.1.0_r2\frameworks\native\libs\gui\BitTube.cpp...</text></switch></g><path d="M 2937 1849 Q 2967 1849 3202 1816.5 Q 3437 1784 3460.63 1784" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 3465.88 1784 L 3458.88 1787.5 L 3460.63 1784 L 3458.88 1780.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="2932" cy="1849" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><path d="M 977 1919 Q 1007 1919 1202 1851.5 Q 1397 1784 1420.63 1784" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1425.88 1784 L 1418.88 1787.5 L 1420.63 1784 L 1418.88 1780.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="972" cy="1919" rx="5" ry="5" fill="#000000" stroke="none" pointer-events="all"/><rect x="1627" y="1964" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1974px; margin-left: 1628px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">2-4</div></div></div></foreignObject><text x="1642" y="1978" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2-4</text></switch></g><rect x="3560" y="1966" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 1976px; margin-left: 3561px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">2-5</div></div></div></foreignObject><text x="3575" y="1980" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">2-5</text></switch></g><rect x="54" y="2210" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2220px; margin-left: 55px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">3-1</div></div></div></foreignObject><text x="69" y="2224" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-1</text></switch></g><rect x="837" y="2574" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2584px; margin-left: 838px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">3-2</div></div></div></foreignObject><text x="852" y="2588" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-2</text></switch></g><rect x="2256" y="2590" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2600px; margin-left: 2257px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">3-3</div></div></div></foreignObject><text x="2271" y="2604" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-3</text></switch></g><rect x="2868" y="2431" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2441px; margin-left: 2869px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">3-4</div></div></div></foreignObject><text x="2883" y="2445" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">3-4</text></switch></g><rect x="4237" y="2588" width="30" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 28px; height: 1px; padding-top: 2598px; margin-left: 4238px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-4</div></div></div></foreignObject><text x="4252" y="2602" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-4</text></switch></g><rect x="5070" y="1771" width="40" height="20" rx="10" ry="10" fill="#ff0000" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 1781px; margin-left: 5071px;"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 255, 255); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">1-6-1</div></div></div></foreignObject><text x="5090" y="1785" fill="#FFFFFF" font-family="Helvetica" font-size="12px" text-anchor="middle">1-6-1</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>